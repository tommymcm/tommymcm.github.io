<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LLVM: lib/Transforms/IPO/DeadArgumentElimination.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">LLVM<span id="projectnumber">&#160;9.0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_a72932e0778af28115095468f6286ff8.html">Transforms</a></li><li class="navelem"><a class="el" href="dir_13abb262e9c52ddea8d07639819afd6c.html">IPO</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle"><div class="title">DeadArgumentElimination.cpp</div></div>
</div><!--header-->
<div class="contents">
<a href="DeadArgumentElimination_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">//===- DeadArgumentElimination.cpp - Eliminate dead arguments -------------===//</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment">//</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="comment">// See https://llvm.org/LICENSE.txt for license information.</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="comment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="comment">//</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="comment">//</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="comment">// This pass deletes dead arguments from internal functions.  Dead argument</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="comment">// elimination removes arguments which are directly dead, as well as arguments</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="comment">// only passed into function calls as dead arguments of other functions.  This</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="comment">// pass also deletes dead return values in a similar way.</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="comment">//</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="comment">// This pass is often useful as a cleanup pass to run after aggressive</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="comment">// interprocedural passes, which add possibly-dead arguments or return values.</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="comment">//</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span> </div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="preprocessor">#include &quot;llvm/Transforms/IPO/DeadArgumentElimination.h&quot;</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="preprocessor">#include &quot;llvm/ADT/SmallVector.h&quot;</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="preprocessor">#include &quot;llvm/ADT/Statistic.h&quot;</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="preprocessor">#include &quot;llvm/IR/Argument.h&quot;</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="preprocessor">#include &quot;llvm/IR/Attributes.h&quot;</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="preprocessor">#include &quot;llvm/IR/BasicBlock.h&quot;</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span><span class="preprocessor">#include &quot;llvm/IR/CallSite.h&quot;</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="preprocessor">#include &quot;llvm/IR/Constants.h&quot;</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="preprocessor">#include &quot;llvm/IR/DerivedTypes.h&quot;</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span><span class="preprocessor">#include &quot;llvm/IR/Function.h&quot;</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span><span class="preprocessor">#include &quot;llvm/IR/InstrTypes.h&quot;</span></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="preprocessor">#include &quot;llvm/IR/Instruction.h&quot;</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="preprocessor">#include &quot;llvm/IR/Instructions.h&quot;</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span><span class="preprocessor">#include &quot;llvm/IR/IntrinsicInst.h&quot;</span></div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span><span class="preprocessor">#include &quot;llvm/IR/Intrinsics.h&quot;</span></div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span><span class="preprocessor">#include &quot;llvm/IR/Module.h&quot;</span></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span><span class="preprocessor">#include &quot;llvm/IR/PassManager.h&quot;</span></div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span><span class="preprocessor">#include &quot;llvm/IR/Type.h&quot;</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span><span class="preprocessor">#include &quot;llvm/IR/Use.h&quot;</span></div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span><span class="preprocessor">#include &quot;llvm/IR/User.h&quot;</span></div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span><span class="preprocessor">#include &quot;llvm/IR/Value.h&quot;</span></div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span><span class="preprocessor">#include &quot;llvm/Pass.h&quot;</span></div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span><span class="preprocessor">#include &quot;llvm/Support/Casting.h&quot;</span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span><span class="preprocessor">#include &quot;llvm/Support/Debug.h&quot;</span></div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span><span class="preprocessor">#include &quot;llvm/Support/raw_ostream.h&quot;</span></div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span><span class="preprocessor">#include &quot;llvm/Transforms/IPO.h&quot;</span></div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span><span class="preprocessor">#include &quot;llvm/Transforms/Utils/BasicBlockUtils.h&quot;</span></div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span><span class="preprocessor">#include &lt;cassert&gt;</span></div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span><span class="preprocessor">#include &lt;cstdint&gt;</span></div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span><span class="preprocessor">#include &lt;utility&gt;</span></div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span> </div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span><span class="keyword">using namespace </span><a class="code hl_namespace" href="namespacellvm.html">llvm</a>;</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span> </div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno"><a class="line" href="DeadArgumentElimination_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">   53</a></span><span class="preprocessor">#define DEBUG_TYPE &quot;deadargelim&quot;</span></div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span> </div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno"><a class="line" href="DeadArgumentElimination_8cpp.html#a1900bcaf9d2e4c769d421f858c7af5b0">   55</a></span><a class="code hl_function" href="DeadArgumentElimination_8cpp.html#a1900bcaf9d2e4c769d421f858c7af5b0">STATISTIC</a>(NumArgumentsEliminated, <span class="stringliteral">&quot;Number of unread args removed&quot;</span>);</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno"><a class="line" href="DeadArgumentElimination_8cpp.html#af6cbe35492dede2d49e6d494419834b3">   56</a></span><a class="code hl_function" href="DeadArgumentElimination_8cpp.html#a1900bcaf9d2e4c769d421f858c7af5b0">STATISTIC</a>(NumRetValsEliminated  , <span class="stringliteral">&quot;Number of unused return values removed&quot;</span>);</div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno"><a class="line" href="DeadArgumentElimination_8cpp.html#a3fe91898cfe8dea405a5fbe0c7145939">   57</a></span><a class="code hl_function" href="DeadArgumentElimination_8cpp.html#a1900bcaf9d2e4c769d421f858c7af5b0">STATISTIC</a>(NumArgumentsReplacedWithUndef,</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>          <span class="stringliteral">&quot;Number of unread args replaced with undef&quot;</span>);</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span> </div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span><span class="keyword">namespace </span>{</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span><span class="comment"></span> </div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span><span class="comment">  /// DAE - The dead argument elimination pass.</span></div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span><span class="comment"></span>  <span class="keyword">class </span>DAE : <span class="keyword">public</span> ModulePass {</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>  <span class="keyword">protected</span>:</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>    <span class="comment">// DAH uses this to specify a different ID.</span></div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>    <span class="keyword">explicit</span> DAE(<span class="keywordtype">char</span> &amp;ID) : ModulePass(ID) {}</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span> </div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>  <span class="keyword">public</span>:</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>    <span class="keyword">static</span> <span class="keywordtype">char</span> ID; <span class="comment">// Pass identification, replacement for typeid</span></div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span> </div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>    DAE() : ModulePass(ID) {</div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>      initializeDAEPass(*PassRegistry::getPassRegistry());</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>    }</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span> </div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>    <span class="keywordtype">bool</span> runOnModule(Module &amp;M)<span class="keyword"> override </span>{</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>      <span class="keywordflow">if</span> (skipModule(M))</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>      DeadArgumentEliminationPass DAEP(ShouldHackArguments());</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>      ModuleAnalysisManager DummyMAM;</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>      PreservedAnalyses PA = DAEP.run(M, DummyMAM);</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>      <span class="keywordflow">return</span> !PA.areAllPreserved();</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>    }</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span> </div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> ShouldHackArguments()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>  };</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span> </div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>} <span class="comment">// end anonymous namespace</span></div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span> </div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span><span class="keywordtype">char</span> DAE::ID = 0;</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span> </div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span><a class="code hl_function" href="DeadArgumentElimination_8cpp.html#a29f209bebc41a635b32c07fbcba0e34f">INITIALIZE_PASS</a>(DAE, <span class="stringliteral">&quot;deadargelim&quot;</span>, <span class="stringliteral">&quot;Dead Argument Elimination&quot;</span>, <span class="keyword">false</span>, <span class="keyword">false</span>)</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span> </div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>namespace {</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span><span class="comment"></span> </div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span><span class="comment">  /// DAH - DeadArgumentHacking pass - Same as dead argument elimination, but</span></div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span><span class="comment">  /// deletes arguments to functions which are external.  This is only for use</span></div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span><span class="comment">  /// by bugpoint.</span></div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span><span class="comment"></span>  <span class="keyword">struct </span>DAH : <span class="keyword">public</span> DAE {</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>    <span class="keyword">static</span> <span class="keywordtype">char</span> ID;</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span> </div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>    DAH() : DAE(ID) {}</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span> </div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>    <span class="keywordtype">bool</span> ShouldHackArguments()<span class="keyword"> const override </span>{ <span class="keywordflow">return</span> <span class="keyword">true</span>; }</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>  };</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span> </div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>} <span class="comment">// end anonymous namespace</span></div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span> </div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span><span class="keywordtype">char</span> DAH::ID = 0;</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span> </div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno"><a class="line" href="DeadArgumentElimination_8cpp.html#a29f209bebc41a635b32c07fbcba0e34f">  110</a></span><a class="code hl_function" href="DeadArgumentElimination_8cpp.html#a29f209bebc41a635b32c07fbcba0e34f">INITIALIZE_PASS</a>(DAH, <span class="stringliteral">&quot;deadarghaX0r&quot;</span>,</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>                <span class="stringliteral">&quot;Dead Argument Hacking (BUGPOINT USE ONLY; DO NOT USE)&quot;</span>,</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>                <span class="keyword">false</span>, <span class="keyword">false</span>)</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span> </div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span><span class="comment">/// createDeadArgEliminationPass - This pass removes arguments from functions</span><span class="comment"></span></div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span><span class="comment">/// which are not used by the body of the function.</span></div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span><span class="comment"></span>ModulePass *<a class="code hl_namespace" href="namespacellvm.html">llvm</a>::createDeadArgEliminationPass() { <span class="keywordflow">return</span> <span class="keyword">new</span> DAE(); }</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span> </div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>ModulePass *llvm::createDeadArgHackingPass() { <span class="keywordflow">return</span> <span class="keyword">new</span> DAH(); }</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span><span class="comment"></span> </div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span><span class="comment">/// DeleteDeadVarargs - If this is an function that takes a ... list, and if</span></div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span><span class="comment">/// llvm.vastart is never called, the varargs list is dead for the function.</span></div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span><span class="comment"></span><span class="keywordtype">bool</span> DeadArgumentEliminationPass::DeleteDeadVarargs(Function &amp;Fn) {</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>  <a class="code hl_function" href="DeadArgumentElimination_8cpp.html#aa5bfc84fa71b9e3477e24efecb60fae5">assert</a>(Fn.getFunctionType()-&gt;isVarArg() &amp;&amp; <span class="stringliteral">&quot;Function isn&#39;t varargs!&quot;</span>);</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>  <span class="keywordflow">if</span> (Fn.isDeclaration() || !Fn.hasLocalLinkage()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span> </div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>  <span class="comment">// Ensure that the function is only directly called.</span></div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>  <span class="keywordflow">if</span> (Fn.hasAddressTaken())</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span> </div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>  <span class="comment">// Don&#39;t touch naked functions. The assembly might be using an argument, or</span></div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>  <span class="comment">// otherwise rely on the frame layout in a way that this analysis will not</span></div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>  <span class="comment">// see.</span></div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>  <span class="keywordflow">if</span> (Fn.hasFnAttribute(Attribute::Naked)) {</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>  }</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span> </div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>  <span class="comment">// Okay, we know we can transform this function if safe.  Scan its body</span></div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>  <span class="comment">// looking for calls marked musttail or calls to llvm.vastart.</span></div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>  <span class="keywordflow">for</span> (BasicBlock &amp;BB : Fn) {</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>    <span class="keywordflow">for</span> (Instruction &amp;<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : BB) {</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>      CallInst *CI = dyn_cast&lt;CallInst&gt;(&amp;<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>      <span class="keywordflow">if</span> (!CI)</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>        <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>      <span class="keywordflow">if</span> (CI-&gt;isMustTailCall())</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>      <span class="keywordflow">if</span> (<a class="code hl_class" href="classIntrinsicInst.html">IntrinsicInst</a> *II = dyn_cast&lt;IntrinsicInst&gt;(CI)) {</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>        <span class="keywordflow">if</span> (II-&gt;getIntrinsicID() == Intrinsic::vastart)</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>      }</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>    }</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>  }</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span> </div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>  <span class="comment">// If we get here, there are no calls to llvm.vastart in the function body,</span></div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>  <span class="comment">// remove the &quot;...&quot; and adjust all the calls.</span></div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span> </div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>  <span class="comment">// Start by computing a new prototype for the function, which is the same as</span></div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>  <span class="comment">// the old function, but doesn&#39;t have isVarArg set.</span></div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>  FunctionType *FTy = Fn.getFunctionType();</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span> </div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>  std::vector&lt;Type *&gt; Params(FTy-&gt;param_begin(), FTy-&gt;param_end());</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>  FunctionType *NFTy = FunctionType::get(FTy-&gt;getReturnType(),</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>                                                Params, <span class="keyword">false</span>);</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>  <span class="keywordtype">unsigned</span> NumArgs = Params.size();</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span> </div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>  <span class="comment">// Create the new function body and insert it into the module...</span></div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>  Function *NF = Function::Create(NFTy, Fn.getLinkage(), Fn.getAddressSpace());</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>  NF-&gt;copyAttributesFrom(&amp;Fn);</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>  NF-&gt;setComdat(Fn.getComdat());</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>  Fn.getParent()-&gt;getFunctionList().insert(Fn.getIterator(), NF);</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>  NF-&gt;takeName(&amp;Fn);</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span> </div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>  <span class="comment">// Loop over all of the callers of the function, transforming the call sites</span></div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>  <span class="comment">// to pass in a smaller number of arguments into the new function.</span></div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>  <span class="comment">//</span></div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>  std::vector&lt;Value *&gt; Args;</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>  <span class="keywordflow">for</span> (Value::user_iterator <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Fn.user_begin(), E = Fn.user_end(); <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ) {</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>    CallSite CS(*<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>++);</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>    <span class="keywordflow">if</span> (!CS)</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>    Instruction *Call = CS.getInstruction();</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span> </div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>    <span class="comment">// Pass all the same arguments.</span></div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>    Args.assign(CS.arg_begin(), CS.arg_begin() + NumArgs);</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span> </div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>    <span class="comment">// Drop any attributes that were on the vararg arguments.</span></div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>    AttributeList PAL = CS.getAttributes();</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>    <span class="keywordflow">if</span> (!PAL.isEmpty()) {</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>      <a class="code hl_class" href="classSmallVector.html">SmallVector&lt;AttributeSet, 8&gt;</a> ArgAttrs;</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> ArgNo = 0; ArgNo &lt; NumArgs; ++ArgNo)</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>        ArgAttrs.push_back(PAL.getParamAttributes(ArgNo));</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>      PAL = AttributeList::get(Fn.getContext(), PAL.getFnAttributes(),</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>                               PAL.getRetAttributes(), ArgAttrs);</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>    }</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span> </div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>    <a class="code hl_class" href="classSmallVector.html">SmallVector&lt;OperandBundleDef, 1&gt;</a> OpBundles;</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>    CS.getOperandBundlesAsDefs(OpBundles);</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span> </div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>    CallSite NewCS;</div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>    <span class="keywordflow">if</span> (InvokeInst *II = dyn_cast&lt;InvokeInst&gt;(Call)) {</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>      NewCS = InvokeInst::Create(NF, II-&gt;getNormalDest(), II-&gt;getUnwindDest(),</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>                                 Args, OpBundles, <span class="stringliteral">&quot;&quot;</span>, Call);</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>      NewCS = CallInst::Create(NF, Args, OpBundles, <span class="stringliteral">&quot;&quot;</span>, Call);</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>      cast&lt;CallInst&gt;(NewCS.getInstruction())</div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>          -&gt;setTailCallKind(cast&lt;CallInst&gt;(Call)-&gt;getTailCallKind());</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>    }</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>    NewCS.setCallingConv(CS.getCallingConv());</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>    NewCS.setAttributes(PAL);</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>    NewCS-&gt;setDebugLoc(Call-&gt;getDebugLoc());</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>    uint64_t W;</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>    <span class="keywordflow">if</span> (Call-&gt;extractProfTotalWeight(W))</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>      NewCS-&gt;setProfWeight(W);</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span> </div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>    Args.clear();</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span> </div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>    <span class="keywordflow">if</span> (!Call-&gt;use_empty())</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>      Call-&gt;replaceAllUsesWith(NewCS.getInstruction());</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span> </div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>    NewCS-&gt;takeName(Call);</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span> </div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>    <span class="comment">// Finally, remove the old call from the program, reducing the use-count of</span></div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>    <span class="comment">// F.</span></div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>    Call-&gt;eraseFromParent();</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>  }</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span> </div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>  <span class="comment">// Since we have now created the new function, splice the body of the old</span></div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>  <span class="comment">// function right into the new function, leaving the old rotting hulk of the</span></div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>  <span class="comment">// function empty.</span></div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>  NF-&gt;getBasicBlockList().splice(NF-&gt;begin(), Fn.getBasicBlockList());</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span> </div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>  <span class="comment">// Loop over the argument list, transferring uses of the old arguments over to</span></div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>  <span class="comment">// the new arguments, also transferring over the names as well.  While we&#39;re at</span></div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>  <span class="comment">// it, remove the dead arguments from the DeadArguments list.</span></div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>  <span class="keywordflow">for</span> (Function::arg_iterator <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Fn.arg_begin(), E = Fn.arg_end(),</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>       I2 = NF-&gt;arg_begin(); <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, ++I2) {</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>    <span class="comment">// Move the name and users over to the new version.</span></div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>    <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;replaceAllUsesWith(&amp;*I2);</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>    I2-&gt;takeName(&amp;*<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>  }</div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span> </div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>  <span class="comment">// Clone metadatas from the old function, including debug info descriptor.</span></div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>  <a class="code hl_class" href="classSmallVector.html">SmallVector&lt;std::pair&lt;unsigned, MDNode *&gt;</a>, 1&gt; MDs;</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>  Fn.getAllMetadata(MDs);</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> MD : MDs)</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>    NF-&gt;addMetadata(MD.first, *MD.second);</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span> </div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>  <span class="comment">// Fix up any BlockAddresses that refer to the function.</span></div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>  Fn.replaceAllUsesWith(ConstantExpr::getBitCast(NF, Fn.getType()));</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>  <span class="comment">// Delete the bitcast that we just created, so that NF does not</span></div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>  <span class="comment">// appear to be address-taken.</span></div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>  NF-&gt;removeDeadConstantUsers();</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>  <span class="comment">// Finally, nuke the old function.</span></div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>  Fn.eraseFromParent();</div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>}</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span><span class="comment"></span> </div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span><span class="comment">/// RemoveDeadArgumentsFromCallers - Checks if the given function has any</span></div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span><span class="comment">/// arguments that are unused, and changes the caller parameters to be undefined</span></div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span><span class="comment">/// instead.</span></div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span><span class="comment"></span><span class="keywordtype">bool</span> DeadArgumentEliminationPass::RemoveDeadArgumentsFromCallers(Function &amp;Fn) {</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>  <span class="comment">// We cannot change the arguments if this TU does not define the function or</span></div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>  <span class="comment">// if the linker may choose a function body from another TU, even if the</span></div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>  <span class="comment">// nominal linkage indicates that other copies of the function have the same</span></div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>  <span class="comment">// semantics. In the below example, the dead load from %p may not have been</span></div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>  <span class="comment">// eliminated from the linker-chosen copy of f, so replacing %p with undef</span></div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>  <span class="comment">// in callers may introduce undefined behavior.</span></div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>  <span class="comment">//</span></div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>  <span class="comment">// define linkonce_odr void @f(i32* %p) {</span></div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>  <span class="comment">//   %v = load i32 %p</span></div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>  <span class="comment">//   ret void</span></div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>  <span class="comment">// }</span></div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>  <span class="keywordflow">if</span> (!Fn.hasExactDefinition())</div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span> </div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>  <span class="comment">// Functions with local linkage should already have been handled, except the</span></div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>  <span class="comment">// fragile (variadic) ones which we can improve here.</span></div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>  <span class="keywordflow">if</span> (Fn.hasLocalLinkage() &amp;&amp; !Fn.getFunctionType()-&gt;isVarArg())</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span> </div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>  <span class="comment">// Don&#39;t touch naked functions. The assembly might be using an argument, or</span></div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>  <span class="comment">// otherwise rely on the frame layout in a way that this analysis will not</span></div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>  <span class="comment">// see.</span></div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>  <span class="keywordflow">if</span> (Fn.hasFnAttribute(Attribute::Naked))</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span> </div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>  <span class="keywordflow">if</span> (Fn.use_empty())</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span> </div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>  <a class="code hl_class" href="classSmallVector.html">SmallVector&lt;unsigned, 8&gt;</a> UnusedArgs;</div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span> </div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>  <span class="keywordflow">for</span> (Argument &amp;Arg : Fn.args()) {</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>    <span class="keywordflow">if</span> (!Arg.hasSwiftErrorAttr() &amp;&amp; Arg.use_empty() &amp;&amp; !Arg.hasByValOrInAllocaAttr()) {</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>      <span class="keywordflow">if</span> (Arg.isUsedByMetadata()) {</div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>        Arg.replaceAllUsesWith(UndefValue::get(Arg.getType()));</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>        Changed = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>      }</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>      UnusedArgs.push_back(Arg.getArgNo());</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>    }</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>  }</div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span> </div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>  <span class="keywordflow">if</span> (UnusedArgs.empty())</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span> </div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>  <span class="keywordflow">for</span> (Use &amp;U : Fn.uses()) {</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>    CallSite CS(U.getUser());</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>    <span class="keywordflow">if</span> (!CS || !CS.isCallee(&amp;U))</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span> </div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>    <span class="comment">// Now go through all unused args and replace them with &quot;undef&quot;.</span></div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, E = UnusedArgs.size(); <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>      <span class="keywordtype">unsigned</span> ArgNo = UnusedArgs[<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>];</div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span> </div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>      Value *Arg = CS.getArgument(ArgNo);</div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>      CS.setArgument(ArgNo, UndefValue::get(Arg-&gt;getType()));</div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>      ++NumArgumentsReplacedWithUndef;</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>      Changed = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>    }</div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>  }</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span> </div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>  <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>}</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span><span class="comment"></span> </div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span><span class="comment">/// Convenience function that returns the number of return values. It returns 0</span></div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span><span class="comment">/// for void functions and 1 for functions not returning a struct. It returns</span></div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span><span class="comment">/// the number of struct elements for functions returning a struct.</span></div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno"><a class="line" href="DeadArgumentElimination_8cpp.html#a4cf8dce0e06abc322a465d6a2b779008">  327</a></span><span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">unsigned</span> <a class="code hl_function" href="DeadArgumentElimination_8cpp.html#a4cf8dce0e06abc322a465d6a2b779008">NumRetVals</a>(<span class="keyword">const</span> Function *<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>  Type *<a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#ae9e8b37f293199ceac2a52f811e26a3e">RetTy</a> = <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getReturnType();</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#ae9e8b37f293199ceac2a52f811e26a3e">RetTy</a>-&gt;isVoidTy())</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (StructType *STy = dyn_cast&lt;StructType&gt;(<a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#ae9e8b37f293199ceac2a52f811e26a3e">RetTy</a>))</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>    <span class="keywordflow">return</span> STy-&gt;getNumElements();</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ArrayType *ATy = dyn_cast&lt;ArrayType&gt;(<a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#ae9e8b37f293199ceac2a52f811e26a3e">RetTy</a>))</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>    <span class="keywordflow">return</span> ATy-&gt;getNumElements();</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>  <span class="keywordflow">else</span></div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>}</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span><span class="comment"></span> </div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span><span class="comment">/// Returns the sub-type a function will return at a given Idx. Should</span></div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span><span class="comment">/// correspond to the result type of an ExtractValue instruction executed with</span></div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno"><a class="line" href="DeadArgumentElimination_8cpp.html#af243ab59f2101cfb9b6c19591bc4dfd5">  341</a></span><span class="comment">/// just that one Idx (i.e. only top-level structure is considered).</span></div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno"><a class="line" href="DeadArgumentElimination_8cpp.html#a39a491a969849f634027f20be70a5c57">  342</a></span><span class="comment"></span><span class="keyword">static</span> Type *getRetComponentType(<span class="keyword">const</span> Function *<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <span class="keywordtype">unsigned</span> <a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#a39a491a969849f634027f20be70a5c57">Idx</a>) {</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>  Type *<a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#ae9e8b37f293199ceac2a52f811e26a3e">RetTy</a> = <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getReturnType();</div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno"><a class="line" href="DeadArgumentElimination_8cpp.html#aa5bfc84fa71b9e3477e24efecb60fae5">  344</a></span>  <a class="code hl_function" href="DeadArgumentElimination_8cpp.html#aa5bfc84fa71b9e3477e24efecb60fae5">assert</a>(!<a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#ae9e8b37f293199ceac2a52f811e26a3e">RetTy</a>-&gt;isVoidTy() &amp;&amp; <span class="stringliteral">&quot;void type has no subtype&quot;</span>);</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span> </div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno"><a class="line" href="DeadArgumentElimination_8cpp.html#ac09a30d47dd36dfe05dda91e8d67e92f">  346</a></span>  <span class="keywordflow">if</span> (StructType *STy = dyn_cast&lt;StructType&gt;(<a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#ae9e8b37f293199ceac2a52f811e26a3e">RetTy</a>))</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>    <span class="keywordflow">return</span> STy-&gt;getElementType(<a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#a39a491a969849f634027f20be70a5c57">Idx</a>);</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno"><a class="line" href="DeadArgumentElimination_8cpp.html#a91f75a3317e2f51500f0341aaf1ec744">  348</a></span>  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ArrayType *ATy = dyn_cast&lt;ArrayType&gt;(<a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#ae9e8b37f293199ceac2a52f811e26a3e">RetTy</a>))</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>    <span class="keywordflow">return</span> ATy-&gt;getElementType();</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>  <span class="keywordflow">else</span></div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno"><a class="line" href="DeadArgumentElimination_8cpp.html#ae9e8b37f293199ceac2a52f811e26a3e">  351</a></span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#ae9e8b37f293199ceac2a52f811e26a3e">RetTy</a>;</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>}</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span><span class="comment"></span> </div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span><span class="comment">/// MarkIfNotLive - This checks Use for liveness in LiveValues. If Use is not</span></div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno"><a class="line" href="DeadArgumentElimination_8cpp.html#a0ecf27c4fbaac843ec70223bf08b0445">  355</a></span><span class="comment">/// live, it adds Use to the MaybeLiveUses argument. Returns the determined</span></div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span><span class="comment">/// liveness of Use.</span></div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span><span class="comment"></span>DeadArgumentEliminationPass::Liveness</div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>DeadArgumentEliminationPass::MarkIfNotLive(RetOrArg Use,</div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>                                           UseVector &amp;MaybeLiveUses) {</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>  <span class="comment">// We&#39;re live if our use or its Function is already marked as live.</span></div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>  <span class="keywordflow">if</span> (LiveFunctions.count(Use.F) || LiveValues.count(Use))</div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#a4e86f60fbe61a3e52ab0ba9183cc3fe5">Live</a>;</div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span> </div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>  <span class="comment">// We&#39;re maybe live otherwise, but remember that we must become live if</span></div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>  <span class="comment">// Use becomes live.</span></div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>  MaybeLiveUses.push_back(Use);</div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>  <span class="keywordflow">return</span> <a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#a51708575b9cff0a8b80837dac8427c4d">MaybeLive</a>;</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>}</div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span><span class="comment"></span> </div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span><span class="comment">/// SurveyUse - This looks at a single use of an argument or return value</span></div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span><span class="comment">/// and determines if it should be alive or not. Adds this use to MaybeLiveUses</span></div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span><span class="comment">/// if it causes the used value to become MaybeLive.</span></div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span><span class="comment">///</span></div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span><span class="comment">/// RetValNum is the return value number to use when this use is used in a</span></div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno"><a class="line" href="DeadArgumentElimination_8cpp.html#a05fa3b6b6c6cbc0732f37d9953bdf480">  375</a></span><span class="comment">/// return instruction. This is used in the recursion, you should always leave</span></div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span><span class="comment">/// it at 0.</span></div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span><span class="comment"></span>DeadArgumentEliminationPass::Liveness</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>DeadArgumentEliminationPass::SurveyUse(<span class="keyword">const</span> Use *U, UseVector &amp;MaybeLiveUses,</div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>                                       <span class="keywordtype">unsigned</span> RetValNum) {</div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>    <span class="keyword">const</span> User *V = U-&gt;getUser();</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>    <span class="keywordflow">if</span> (<span class="keyword">const</span> ReturnInst *RI = dyn_cast&lt;ReturnInst&gt;(V)) {</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>      <span class="comment">// The value is returned from a function. It&#39;s only live when the</span></div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>      <span class="comment">// function&#39;s return value is live. We use RetValNum here, for the case</span></div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>      <span class="comment">// that U is really a use of an insertvalue instruction that uses the</span></div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>      <span class="comment">// original Use.</span></div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>      <span class="keyword">const</span> Function *<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = RI-&gt;getParent()-&gt;getParent();</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>      <span class="keywordflow">if</span> (RetValNum != -1U) {</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>        RetOrArg Use = CreateRet(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, RetValNum);</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>        <span class="comment">// We might be live, depending on the liveness of Use.</span></div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>        <span class="keywordflow">return</span> MarkIfNotLive(Use, MaybeLiveUses);</div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>        DeadArgumentEliminationPass::Liveness Result = <a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#a51708575b9cff0a8b80837dac8427c4d">MaybeLive</a>;</div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; <a class="code hl_function" href="DeadArgumentElimination_8cpp.html#a4cf8dce0e06abc322a465d6a2b779008">NumRetVals</a>(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>); ++i) {</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>          RetOrArg Use = CreateRet(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, i);</div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>          <span class="comment">// We might be live, depending on the liveness of Use. If any</span></div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>          <span class="comment">// sub-value is live, then the entire value is considered live. This</span></div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>          <span class="comment">// is a conservative choice, and better tracking is possible.</span></div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>          DeadArgumentEliminationPass::Liveness SubResult =</div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>              MarkIfNotLive(Use, MaybeLiveUses);</div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>          <span class="keywordflow">if</span> (Result != <a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#a4e86f60fbe61a3e52ab0ba9183cc3fe5">Live</a>)</div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>            Result = SubResult;</div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>        }</div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>        <span class="keywordflow">return</span> Result;</div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>      }</div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>    }</div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>    <span class="keywordflow">if</span> (<span class="keyword">const</span> InsertValueInst *IV = dyn_cast&lt;InsertValueInst&gt;(V)) {</div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>      <span class="keywordflow">if</span> (U-&gt;getOperandNo() != InsertValueInst::getAggregateOperandIndex()</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>          &amp;&amp; IV-&gt;hasIndices())</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>        <span class="comment">// The use we are examining is inserted into an aggregate. Our liveness</span></div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>        <span class="comment">// depends on all uses of that aggregate, but if it is used as a return</span></div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>        <span class="comment">// value, only index at which we were inserted counts.</span></div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>        RetValNum = *IV-&gt;idx_begin();</div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span> </div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>      <span class="comment">// Note that if we are used as the aggregate operand to the insertvalue,</span></div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>      <span class="comment">// we don&#39;t change RetValNum, but do survey all our uses.</span></div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span> </div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>      Liveness Result = <a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#a51708575b9cff0a8b80837dac8427c4d">MaybeLive</a>;</div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>      <span class="keywordflow">for</span> (<span class="keyword">const</span> Use &amp;UU : IV-&gt;uses()) {</div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>        Result = SurveyUse(&amp;UU, MaybeLiveUses, RetValNum);</div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>        <span class="keywordflow">if</span> (Result == <a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#a4e86f60fbe61a3e52ab0ba9183cc3fe5">Live</a>)</div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>          <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>      }</div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>      <span class="keywordflow">return</span> Result;</div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>    }</div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span> </div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>    <span class="keywordflow">if</span> (<span class="keyword">auto</span> CS = ImmutableCallSite(V)) {</div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>      <span class="keyword">const</span> Function *<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = CS.getCalledFunction();</div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>      <span class="keywordflow">if</span> (<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>        <span class="comment">// Used in a direct call.</span></div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span> </div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>        <span class="comment">// The function argument is live if it is used as a bundle operand.</span></div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span>        <span class="keywordflow">if</span> (CS.isBundleOperand(U))</div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>          <span class="keywordflow">return</span> <a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#a4e86f60fbe61a3e52ab0ba9183cc3fe5">Live</a>;</div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span> </div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>        <span class="comment">// Find the argument number. We know for sure that this use is an</span></div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>        <span class="comment">// argument, since if it was the function argument this would be an</span></div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>        <span class="comment">// indirect call and the we know can&#39;t be looking at a value of the</span></div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>        <span class="comment">// label type (for the invoke instruction).</span></div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>        <span class="keywordtype">unsigned</span> ArgNo = CS.getArgumentNo(U);</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span> </div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span>        <span class="keywordflow">if</span> (ArgNo &gt;= <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getFunctionType()-&gt;getNumParams())</div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>          <span class="comment">// The value is passed in through a vararg! Must be live.</span></div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>          <span class="keywordflow">return</span> <a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#a4e86f60fbe61a3e52ab0ba9183cc3fe5">Live</a>;</div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span> </div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span>        <a class="code hl_function" href="DeadArgumentElimination_8cpp.html#aa5bfc84fa71b9e3477e24efecb60fae5">assert</a>(CS.getArgument(ArgNo)</div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>               == CS-&gt;getOperand(U-&gt;getOperandNo())</div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>               &amp;&amp; <span class="stringliteral">&quot;Argument is not where we expected it&quot;</span>);</div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span> </div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>        <span class="comment">// Value passed to a normal call. It&#39;s only live when the corresponding</span></div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>        <span class="comment">// argument to the called function turns out live.</span></div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>        RetOrArg Use = CreateArg(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, ArgNo);</div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>        <span class="keywordflow">return</span> MarkIfNotLive(Use, MaybeLiveUses);</div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>      }</div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>    }</div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>    <span class="comment">// Used in any other way? Value must be live.</span></div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#a4e86f60fbe61a3e52ab0ba9183cc3fe5">Live</a>;</div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>}</div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span><span class="comment"></span> </div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span><span class="comment">/// SurveyUses - This looks at all the uses of the given value</span></div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span><span class="comment">/// Returns the Liveness deduced from the uses of this value.</span></div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span><span class="comment">///</span></div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span><span class="comment">/// Adds all uses that cause the result to be MaybeLive to MaybeLiveRetUses. If</span></div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno"><a class="line" href="DeadArgumentElimination_8cpp.html#a4e86f60fbe61a3e52ab0ba9183cc3fe5">  463</a></span><span class="comment">/// the result is Live, MaybeLiveUses might be modified but its content should</span></div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno"><a class="line" href="DeadArgumentElimination_8cpp.html#a8c53890d9af8c2ef767eb119edf7ad76">  464</a></span><span class="comment">/// be ignored (since it might not be complete).</span></div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span><span class="comment"></span>DeadArgumentEliminationPass::Liveness</div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>DeadArgumentEliminationPass::SurveyUses(<span class="keyword">const</span> Value *V,</div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>                                        UseVector &amp;MaybeLiveUses) {</div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>  <span class="comment">// Assume it&#39;s dead (which will only hold if there are no uses at all..).</span></div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>  Liveness Result = <a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#a51708575b9cff0a8b80837dac8427c4d">MaybeLive</a>;</div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>  <span class="comment">// Check each use.</span></div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>  <span class="keywordflow">for</span> (<span class="keyword">const</span> Use &amp;U : V-&gt;uses()) {</div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span>    Result = SurveyUse(&amp;U, MaybeLiveUses);</div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span>    <span class="keywordflow">if</span> (Result == <a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#a4e86f60fbe61a3e52ab0ba9183cc3fe5">Live</a>)</div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>  }</div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>  <span class="keywordflow">return</span> Result;</div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>}</div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span> </div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span><span class="comment">// SurveyFunction - This performs the initial survey of the specified function,</span></div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span><span class="comment">// checking out whether or not it uses any of its incoming arguments or whether</span></div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span><span class="comment">// any callers use the return value.  This fills in the LiveValues set and Uses</span></div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span><span class="comment">// map.</span></div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span><span class="comment">//</span></div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span><span class="comment">// We consider arguments of non-internal functions to be intrinsically alive as</span></div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span><span class="comment">// well as arguments to functions which have their &quot;address taken&quot;.</span></div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span><span class="keywordtype">void</span> DeadArgumentEliminationPass::SurveyFunction(<span class="keyword">const</span> Function &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span>  <span class="comment">// Functions with inalloca parameters are expecting args in a particular</span></div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span>  <span class="comment">// register and memory layout.</span></div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>  <span class="keywordflow">if</span> (<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getAttributes().hasAttrSomewhere(Attribute::InAlloca)) {</div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>    MarkLive(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span>  }</div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span> </div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>  <span class="comment">// Don&#39;t touch naked functions. The assembly might be using an argument, or</span></div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>  <span class="comment">// otherwise rely on the frame layout in a way that this analysis will not</span></div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>  <span class="comment">// see.</span></div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>  <span class="keywordflow">if</span> (<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasFnAttribute(Attribute::Naked)) {</div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>    MarkLive(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>  }</div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span> </div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>  <span class="keywordtype">unsigned</span> RetCount = <a class="code hl_function" href="DeadArgumentElimination_8cpp.html#a4cf8dce0e06abc322a465d6a2b779008">NumRetVals</a>(&amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span> </div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>  <span class="comment">// Assume all return values are dead</span></div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>  <span class="keyword">using </span>RetVals = <a class="code hl_class" href="classSmallVector.html">SmallVector&lt;Liveness, 5&gt;</a>;</div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span> </div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span>  RetVals RetValLiveness(RetCount, <a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#a51708575b9cff0a8b80837dac8427c4d">MaybeLive</a>);</div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span> </div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>  <span class="keyword">using </span>RetUses = <a class="code hl_class" href="classSmallVector.html">SmallVector&lt;UseVector, 5&gt;</a>;</div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span> </div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span>  <span class="comment">// These vectors map each return value to the uses that make it MaybeLive, so</span></div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>  <span class="comment">// we can add those to the Uses map if the return value really turns out to be</span></div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span>  <span class="comment">// MaybeLive. Initialized to a list of RetCount empty lists.</span></div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span>  RetUses MaybeLiveRetUses(RetCount);</div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span> </div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>  <span class="keywordtype">bool</span> HasMustTailCalls = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span> </div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span>  <span class="keywordflow">for</span> (Function::const_iterator BB = <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.begin(), E = <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.end(); BB != E; ++BB) {</div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span>    <span class="keywordflow">if</span> (<span class="keyword">const</span> ReturnInst *RI = dyn_cast&lt;ReturnInst&gt;(BB-&gt;getTerminator())) {</div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span>      <span class="keywordflow">if</span> (RI-&gt;getNumOperands() != 0 &amp;&amp; RI-&gt;getOperand(0)-&gt;getType()</div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span>          != <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getFunctionType()-&gt;getReturnType()) {</div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>        <span class="comment">// We don&#39;t support old style multiple return values.</span></div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span>        MarkLive(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>      }</div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span>    }</div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span> </div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>    <span class="comment">// If we have any returns of `musttail` results - the signature can&#39;t</span></div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>    <span class="comment">// change</span></div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span>    <span class="keywordflow">if</span> (BB-&gt;getTerminatingMustTailCall() != <span class="keyword">nullptr</span>)</div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span>      HasMustTailCalls = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>  }</div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span> </div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span>  <span class="keywordflow">if</span> (HasMustTailCalls) {</div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span>    LLVM_DEBUG(dbgs() &lt;&lt; <span class="stringliteral">&quot;DeadArgumentEliminationPass - &quot;</span> &lt;&lt; <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getName()</div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span>                      &lt;&lt; <span class="stringliteral">&quot; has musttail calls\n&quot;</span>);</div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span>  }</div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span> </div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>  <span class="keywordflow">if</span> (!<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasLocalLinkage() &amp;&amp; (!ShouldHackArguments || <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.isIntrinsic())) {</div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span>    MarkLive(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span>  }</div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span> </div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span>  LLVM_DEBUG(</div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span>      dbgs() &lt;&lt; <span class="stringliteral">&quot;DeadArgumentEliminationPass - Inspecting callers for fn: &quot;</span></div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span>             &lt;&lt; <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getName() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>  <span class="comment">// Keep track of the number of live retvals, so we can skip checks once all</span></div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span>  <span class="comment">// of them turn out to be live.</span></div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span>  <span class="keywordtype">unsigned</span> NumLiveRetVals = 0;</div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span> </div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span>  <span class="keywordtype">bool</span> HasMustTailCallers = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span> </div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span>  <span class="comment">// Loop all uses of the function.</span></div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span>  <span class="keywordflow">for</span> (<span class="keyword">const</span> Use &amp;U : <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.uses()) {</div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span>    <span class="comment">// If the function is PASSED IN as an argument, its address has been</span></div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span>    <span class="comment">// taken.</span></div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span>    ImmutableCallSite CS(U.getUser());</div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>    <span class="keywordflow">if</span> (!CS || !CS.isCallee(&amp;U)) {</div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span>      MarkLive(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span>    }</div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span> </div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span>    <span class="comment">// The number of arguments for `musttail` call must match the number of</span></div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span>    <span class="comment">// arguments of the caller</span></div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>    <span class="keywordflow">if</span> (CS.isMustTailCall())</div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span>      HasMustTailCallers = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span> </div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span>    <span class="comment">// If this use is anything other than a call site, the function is alive.</span></div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span>    <span class="keyword">const</span> Instruction *TheCall = CS.getInstruction();</div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span>    <span class="keywordflow">if</span> (!TheCall) {   <span class="comment">// Not a direct call site?</span></div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span>      MarkLive(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span>    }</div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span> </div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>    <span class="comment">// If we end up here, we are looking at a direct call to our function.</span></div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span> </div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span>    <span class="comment">// Now, check how our return value(s) is/are used in this caller. Don&#39;t</span></div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>    <span class="comment">// bother checking return values if all of them are live already.</span></div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span>    <span class="keywordflow">if</span> (NumLiveRetVals == RetCount)</div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span> </div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>    <span class="comment">// Check all uses of the return value.</span></div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> Use &amp;U : TheCall-&gt;uses()) {</div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>      <span class="keywordflow">if</span> (ExtractValueInst *Ext = dyn_cast&lt;ExtractValueInst&gt;(U.getUser())) {</div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>        <span class="comment">// This use uses a part of our return value, survey the uses of</span></div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>        <span class="comment">// that part and store the results for this index only.</span></div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span>        <span class="keywordtype">unsigned</span> <a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#a39a491a969849f634027f20be70a5c57">Idx</a> = *Ext-&gt;idx_begin();</div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>        <span class="keywordflow">if</span> (RetValLiveness[<a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#a39a491a969849f634027f20be70a5c57">Idx</a>] != <a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#a4e86f60fbe61a3e52ab0ba9183cc3fe5">Live</a>) {</div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>          RetValLiveness[<a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#a39a491a969849f634027f20be70a5c57">Idx</a>] = SurveyUses(Ext, MaybeLiveRetUses[<a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#a39a491a969849f634027f20be70a5c57">Idx</a>]);</div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>          <span class="keywordflow">if</span> (RetValLiveness[<a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#a39a491a969849f634027f20be70a5c57">Idx</a>] == <a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#a4e86f60fbe61a3e52ab0ba9183cc3fe5">Live</a>)</div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>            NumLiveRetVals++;</div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>        }</div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>        <span class="comment">// Used by something else than extractvalue. Survey, but assume that the</span></div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>        <span class="comment">// result applies to all sub-values.</span></div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span>        UseVector MaybeLiveAggregateUses;</div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>        <span class="keywordflow">if</span> (SurveyUse(&amp;U, MaybeLiveAggregateUses) == <a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#a4e86f60fbe61a3e52ab0ba9183cc3fe5">Live</a>) {</div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>          NumLiveRetVals = RetCount;</div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span>          RetValLiveness.assign(RetCount, <a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#a4e86f60fbe61a3e52ab0ba9183cc3fe5">Live</a>);</div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>          <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span>          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i != RetCount; ++i) {</div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span>            <span class="keywordflow">if</span> (RetValLiveness[i] != <a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#a4e86f60fbe61a3e52ab0ba9183cc3fe5">Live</a>)</div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span>              MaybeLiveRetUses[i].append(MaybeLiveAggregateUses.begin(),</div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span>                                         MaybeLiveAggregateUses.end());</div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span>          }</div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>        }</div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>      }</div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>    }</div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>  }</div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span> </div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>  <span class="keywordflow">if</span> (HasMustTailCallers) {</div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span>    LLVM_DEBUG(dbgs() &lt;&lt; <span class="stringliteral">&quot;DeadArgumentEliminationPass - &quot;</span> &lt;&lt; <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getName()</div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>                      &lt;&lt; <span class="stringliteral">&quot; has musttail callers\n&quot;</span>);</div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span>  }</div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span> </div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>  <span class="comment">// Now we&#39;ve inspected all callers, record the liveness of our return values.</span></div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i != RetCount; ++i)</div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>    MarkValue(CreateRet(&amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, i), RetValLiveness[i], MaybeLiveRetUses[i]);</div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span> </div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span>  LLVM_DEBUG(dbgs() &lt;&lt; <span class="stringliteral">&quot;DeadArgumentEliminationPass - Inspecting args for fn: &quot;</span></div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span>                    &lt;&lt; <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getName() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span> </div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span>  <span class="comment">// Now, check all of our arguments.</span></div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span>  <span class="keywordtype">unsigned</span> i = 0;</div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span>  UseVector MaybeLiveArgUses;</div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>  <span class="keywordflow">for</span> (Function::const_arg_iterator AI = <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.arg_begin(),</div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span>       E = <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.arg_end(); AI != E; ++AI, ++i) {</div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span>    Liveness Result;</div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span>    <span class="keywordflow">if</span> (<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getFunctionType()-&gt;isVarArg() || HasMustTailCallers ||</div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span>        HasMustTailCalls) {</div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span>      <span class="comment">// Variadic functions will already have a va_arg function expanded inside</span></div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span>      <span class="comment">// them, making them potentially very sensitive to ABI changes resulting</span></div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>      <span class="comment">// from removing arguments entirely, so don&#39;t. For example AArch64 handles</span></div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span>      <span class="comment">// register and stack HFAs very differently, and this is reflected in the</span></div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span>      <span class="comment">// IR which has already been generated.</span></div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span>      <span class="comment">//</span></div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span>      <span class="comment">// `musttail` calls to this function restrict argument removal attempts.</span></div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span>      <span class="comment">// The signature of the caller must match the signature of the function.</span></div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span>      <span class="comment">//</span></div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span>      <span class="comment">// `musttail` calls in this function prevents us from changing its</span></div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span>      <span class="comment">// signature</span></div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span>      Result = <a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#a4e86f60fbe61a3e52ab0ba9183cc3fe5">Live</a>;</div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span>      <span class="comment">// See what the effect of this use is (recording any uses that cause</span></div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>      <span class="comment">// MaybeLive in MaybeLiveArgUses).</span></div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span>      Result = SurveyUses(&amp;*AI, MaybeLiveArgUses);</div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span>    }</div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span> </div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span>    <span class="comment">// Mark the result.</span></div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span>    MarkValue(CreateArg(&amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, i), Result, MaybeLiveArgUses);</div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span>    <span class="comment">// Clear the vector again for the next iteration.</span></div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span>    MaybeLiveArgUses.clear();</div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span>  }</div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>}</div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span><span class="comment"></span> </div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span><span class="comment">/// MarkValue - This function marks the liveness of RA depending on L. If L is</span></div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno"><a class="line" href="DeadArgumentElimination_8cpp.html#a51708575b9cff0a8b80837dac8427c4d">  658</a></span><span class="comment">/// MaybeLive, it also takes all uses in MaybeLiveUses and records them in Uses,</span></div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span><span class="comment">/// such that RA will be marked live if any use in MaybeLiveUses gets marked</span></div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span><span class="comment">/// live later on.</span></div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span><span class="comment"></span><span class="keywordtype">void</span> DeadArgumentEliminationPass::MarkValue(<span class="keyword">const</span> RetOrArg &amp;RA, Liveness L,</div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span>                                            <span class="keyword">const</span> UseVector &amp;MaybeLiveUses) {</div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span>  <span class="keywordflow">switch</span> (L) {</div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span>    <span class="keywordflow">case</span> <a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#a4e86f60fbe61a3e52ab0ba9183cc3fe5">Live</a>:</div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span>      MarkLive(RA);</div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span>    <span class="keywordflow">case</span> <a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#a51708575b9cff0a8b80837dac8427c4d">MaybeLive</a>:</div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span>      <span class="comment">// Note any uses of this value, so this return value can be</span></div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span>      <span class="comment">// marked live whenever one of the uses becomes live.</span></div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span>      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;MaybeLiveUse : MaybeLiveUses)</div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span>        <a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#ad803921fc069868f5e116af2e3d4c819">Uses</a>.insert(std::make_pair(MaybeLiveUse, RA));</div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span>  }</div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span>}</div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span><span class="comment"></span> </div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno"><a class="line" href="DeadArgumentElimination_8cpp.html#ae75260bf294a3aee97f4895af05692ac">  676</a></span><span class="comment">/// MarkLive - Mark the given Function as alive, meaning that it cannot be</span></div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno"><a class="line" href="DeadArgumentElimination_8cpp.html#adfe405b6bf3592cbb077ea730cbd2cb6">  677</a></span><span class="comment">/// changed in any way. Additionally,</span></div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span><span class="comment">/// mark any values that are used as this function&#39;s parameters or by its return</span></div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno"><a class="line" href="DeadArgumentElimination_8cpp.html#a98cce07b0e183ed61a1ea9eef0efe743">  679</a></span><span class="comment">/// values (according to Uses) live as well.</span></div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span><span class="comment"></span><span class="keywordtype">void</span> DeadArgumentEliminationPass::MarkLive(<span class="keyword">const</span> Function &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span>  LLVM_DEBUG(dbgs() &lt;&lt; <span class="stringliteral">&quot;DeadArgumentEliminationPass - Intrinsically live fn: &quot;</span></div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span>                    &lt;&lt; <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getName() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span>  <span class="comment">// Mark the function as live.</span></div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span>  LiveFunctions.insert(&amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span>  <span class="comment">// Mark all arguments as live.</span></div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span>  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0, e = <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.arg_size(); i != e; ++i)</div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span>    PropagateLiveness(CreateArg(&amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, i));</div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span>  <span class="comment">// Mark all return values as live.</span></div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span>  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0, e = <a class="code hl_function" href="DeadArgumentElimination_8cpp.html#a4cf8dce0e06abc322a465d6a2b779008">NumRetVals</a>(&amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>); i != e; ++i)</div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span>    PropagateLiveness(CreateRet(&amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, i));</div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span>}</div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span><span class="comment"></span> </div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span><span class="comment">/// MarkLive - Mark the given return value or argument as live. Additionally,</span></div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno"><a class="line" href="DeadArgumentElimination_8cpp.html#a60de8d2348fe991ae774b2cb8202bd30">  694</a></span><span class="comment">/// mark any values that are used by this value (according to Uses) live as</span></div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span><span class="comment">/// well.</span></div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span><span class="comment"></span><span class="keywordtype">void</span> DeadArgumentEliminationPass::MarkLive(<span class="keyword">const</span> RetOrArg &amp;RA) {</div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span>  <span class="keywordflow">if</span> (LiveFunctions.count(RA.F))</div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span>    <span class="keywordflow">return</span>; <span class="comment">// Function was already marked Live.</span></div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span> </div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span>  <span class="keywordflow">if</span> (!LiveValues.insert(RA).second)</div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span>    <span class="keywordflow">return</span>; <span class="comment">// We were already marked Live.</span></div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span> </div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span>  LLVM_DEBUG(dbgs() &lt;&lt; <span class="stringliteral">&quot;DeadArgumentEliminationPass - Marking &quot;</span></div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span>                    &lt;&lt; RA.getDescription() &lt;&lt; <span class="stringliteral">&quot; live\n&quot;</span>);</div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span>  PropagateLiveness(RA);</div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span>}</div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span><span class="comment"></span> </div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno"><a class="line" href="DeadArgumentElimination_8cpp.html#a0fee7123dcef63e27e67cb5aea8e6243">  708</a></span><span class="comment">/// PropagateLiveness - Given that RA is a live value, propagate it&#39;s liveness</span></div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno"><a class="line" href="DeadArgumentElimination_8cpp.html#aba008984447815eaf051160d45db9d18">  709</a></span><span class="comment">/// to any other values it uses (according to Uses).</span></div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span><span class="comment"></span><span class="keywordtype">void</span> DeadArgumentEliminationPass::PropagateLiveness(<span class="keyword">const</span> RetOrArg &amp;RA) {</div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span>  <span class="comment">// We don&#39;t use upper_bound (or equal_range) here, because our recursive call</span></div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span>  <span class="comment">// to ourselves is likely to cause the upper_bound (which is the first value</span></div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>  <span class="comment">// not belonging to RA) to become erased and the iterator invalidated.</span></div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span>  UseMap::iterator Begin = <a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#ad803921fc069868f5e116af2e3d4c819">Uses</a>.lower_bound(RA);</div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span>  UseMap::iterator E = <a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#ad803921fc069868f5e116af2e3d4c819">Uses</a>.end();</div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span>  UseMap::iterator <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span>  <span class="keywordflow">for</span> (<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Begin; <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E &amp;&amp; <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;first == RA; ++<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span>    MarkLive(<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second);</div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span> </div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span>  <span class="comment">// Erase RA from the Uses map (from the lower bound to wherever we ended up</span></div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span>  <span class="comment">// after the loop).</span></div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span>  <a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#ad803921fc069868f5e116af2e3d4c819">Uses</a>.erase(Begin, <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span>}</div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span> </div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span><span class="comment">// RemoveDeadStuffFromFunction - Remove any arguments and return values from F</span></div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span><span class="comment">// that are not in LiveValues. Transform the function and all of the callees of</span></div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span><span class="comment">// the function to not have these arguments and return values.</span></div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span><span class="comment">//</span></div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span><span class="keywordtype">bool</span> DeadArgumentEliminationPass::RemoveDeadStuffFromFunction(Function *<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span>  <span class="comment">// Don&#39;t modify fully live functions</span></div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span>  <span class="keywordflow">if</span> (LiveFunctions.count(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>))</div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span> </div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span>  <span class="comment">// Start by computing a new prototype for the function, which is the same as</span></div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span>  <span class="comment">// the old function, but has fewer arguments and a different return type.</span></div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span>  FunctionType *FTy = <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getFunctionType();</div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span>  std::vector&lt;Type*&gt; Params;</div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span> </div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span>  <span class="comment">// Keep track of if we have a live &#39;returned&#39; argument</span></div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span>  <span class="keywordtype">bool</span> HasLiveReturnedArg = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span> </div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span>  <span class="comment">// Set up to build a new list of parameter attributes.</span></div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span>  <a class="code hl_class" href="classSmallVector.html">SmallVector&lt;AttributeSet, 8&gt;</a> ArgAttrVec;</div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span>  <span class="keyword">const</span> AttributeList &amp;PAL = <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getAttributes();</div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span> </div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span>  <span class="comment">// Remember which arguments are still alive.</span></div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span>  <a class="code hl_class" href="classSmallVector.html">SmallVector&lt;bool, 10&gt;</a> ArgAlive(FTy-&gt;getNumParams(), <span class="keyword">false</span>);</div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span>  <span class="comment">// Construct the new parameter list from non-dead arguments. Also construct</span></div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span>  <span class="comment">// a new set of parameter attributes to correspond. Skip the first parameter</span></div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span>  <span class="comment">// attribute, since that belongs to the return value.</span></div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span>  <span class="keywordtype">unsigned</span> i = 0;</div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span>  <span class="keywordflow">for</span> (Function::arg_iterator <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;arg_begin(), E = <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;arg_end();</div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span>       <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, ++i) {</div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span>    RetOrArg Arg = CreateArg(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, i);</div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span>    <span class="keywordflow">if</span> (LiveValues.erase(Arg)) {</div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span>      Params.push_back(<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType());</div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno">  757</span>      ArgAlive[i] = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span>      ArgAttrVec.push_back(PAL.getParamAttributes(i));</div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span>      HasLiveReturnedArg |= PAL.hasParamAttribute(i, Attribute::Returned);</div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span>      ++NumArgumentsEliminated;</div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span>      LLVM_DEBUG(dbgs() &lt;&lt; <span class="stringliteral">&quot;DeadArgumentEliminationPass - Removing argument &quot;</span></div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span>                        &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getName() &lt;&lt; <span class="stringliteral">&quot;) from &quot;</span></div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span>                        &lt;&lt; <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getName() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span>    }</div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span>  }</div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span> </div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span>  <span class="comment">// Find out the new return value.</span></div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span>  <a class="code hl_enumvalue" href="namespacellvm_1_1lltok.html#af353621f14cb4b4b3af5ffaff84076b1a62040556dca332b530d931cfc532410f">Type</a> *<a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#ae9e8b37f293199ceac2a52f811e26a3e">RetTy</a> = FTy-&gt;getReturnType();</div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno">  770</span>  <a class="code hl_enumvalue" href="namespacellvm_1_1lltok.html#af353621f14cb4b4b3af5ffaff84076b1a62040556dca332b530d931cfc532410f">Type</a> *NRetTy = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span>  <span class="keywordtype">unsigned</span> RetCount = <a class="code hl_function" href="DeadArgumentElimination_8cpp.html#a4cf8dce0e06abc322a465d6a2b779008">NumRetVals</a>(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span> </div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span>  <span class="comment">// -1 means unused, other numbers are the new index</span></div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno">  774</span>  <a class="code hl_class" href="classSmallVector.html">SmallVector&lt;int, 5&gt;</a> NewRetIdxs(RetCount, -1);</div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span>  std::vector&lt;Type*&gt; RetTypes;</div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno">  776</span> </div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno">  777</span>  <span class="comment">// If there is a function with a live &#39;returned&#39; argument but a dead return</span></div>
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno">  778</span>  <span class="comment">// value, then there are two possible actions:</span></div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno">  779</span>  <span class="comment">// 1) Eliminate the return value and take off the &#39;returned&#39; attribute on the</span></div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno">  780</span>  <span class="comment">//    argument.</span></div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span>  <span class="comment">// 2) Retain the &#39;returned&#39; attribute and treat the return value (but not the</span></div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span>  <span class="comment">//    entire function) as live so that it is not eliminated.</span></div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno">  783</span>  <span class="comment">//</span></div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno">  784</span>  <span class="comment">// It&#39;s not clear in the general case which option is more profitable because,</span></div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span>  <span class="comment">// even in the absence of explicit uses of the return value, code generation</span></div>
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno">  786</span>  <span class="comment">// is free to use the &#39;returned&#39; attribute to do things like eliding</span></div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span>  <span class="comment">// save/restores of registers across calls. Whether or not this happens is</span></div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span>  <span class="comment">// target and ABI-specific as well as depending on the amount of register</span></div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span>  <span class="comment">// pressure, so there&#39;s no good way for an IR-level pass to figure this out.</span></div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno">  790</span>  <span class="comment">//</span></div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span>  <span class="comment">// Fortunately, the only places where &#39;returned&#39; is currently generated by</span></div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span>  <span class="comment">// the FE are places where &#39;returned&#39; is basically free and almost always a</span></div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno">  793</span>  <span class="comment">// performance win, so the second option can just be used always for now.</span></div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span>  <span class="comment">//</span></div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno">  795</span>  <span class="comment">// This should be revisited if &#39;returned&#39; is ever applied more liberally.</span></div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#ae9e8b37f293199ceac2a52f811e26a3e">RetTy</a>-&gt;isVoidTy() || HasLiveReturnedArg) {</div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span>    NRetTy = <a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#ae9e8b37f293199ceac2a52f811e26a3e">RetTy</a>;</div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span>    <span class="comment">// Look at each of the original return values individually.</span></div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno">  800</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i != RetCount; ++i) {</div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span>      RetOrArg Ret = CreateRet(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, i);</div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span>      <span class="keywordflow">if</span> (LiveValues.erase(Ret)) {</div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span>        RetTypes.push_back(getRetComponentType(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, i));</div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span>        NewRetIdxs[i] = RetTypes.size() - 1;</div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span>        ++NumRetValsEliminated;</div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span>        LLVM_DEBUG(</div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span>            dbgs() &lt;&lt; <span class="stringliteral">&quot;DeadArgumentEliminationPass - Removing return value &quot;</span></div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span>                   &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; from &quot;</span> &lt;&lt; <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getName() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno">  810</span>      }</div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span>    }</div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span>    <span class="keywordflow">if</span> (RetTypes.size() &gt; 1) {</div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span>      <span class="comment">// More than one return type? Reduce it down to size.</span></div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span>      <span class="keywordflow">if</span> (StructType *STy = dyn_cast&lt;StructType&gt;(<a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#ae9e8b37f293199ceac2a52f811e26a3e">RetTy</a>)) {</div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span>        <span class="comment">// Make the new struct packed if we used to return a packed struct</span></div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span>        <span class="comment">// already.</span></div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span>        NRetTy = StructType::get(STy-&gt;getContext(), RetTypes, STy-&gt;isPacked());</div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span>        <a class="code hl_function" href="DeadArgumentElimination_8cpp.html#aa5bfc84fa71b9e3477e24efecb60fae5">assert</a>(isa&lt;ArrayType&gt;(<a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#ae9e8b37f293199ceac2a52f811e26a3e">RetTy</a>) &amp;&amp; <span class="stringliteral">&quot;unexpected multi-value return&quot;</span>);</div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span>        NRetTy = ArrayType::get(RetTypes[0], RetTypes.size());</div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span>      }</div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (RetTypes.size() == 1)</div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span>      <span class="comment">// One return type? Just a simple value then, but only if we didn&#39;t use to</span></div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span>      <span class="comment">// return a struct with that simple value before.</span></div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span>      NRetTy = RetTypes.front();</div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (RetTypes.empty())</div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span>      <span class="comment">// No return types? Make it void, but only if we didn&#39;t use to return {}.</span></div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span>      NRetTy = Type::getVoidTy(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getContext());</div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span>  }</div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span> </div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span>  <a class="code hl_function" href="DeadArgumentElimination_8cpp.html#aa5bfc84fa71b9e3477e24efecb60fae5">assert</a>(NRetTy &amp;&amp; <span class="stringliteral">&quot;No new return type found?&quot;</span>);</div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span> </div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span>  <span class="comment">// The existing function return attributes.</span></div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno">  834</span>  AttrBuilder RAttrs(PAL.getRetAttributes());</div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span> </div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno">  836</span>  <span class="comment">// Remove any incompatible attributes, but only if we removed all return</span></div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span>  <span class="comment">// values. Otherwise, ensure that we don&#39;t have any conflicting attributes</span></div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span>  <span class="comment">// here. Currently, this should not be possible, but special handling might be</span></div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span>  <span class="comment">// required when new return value attributes are added.</span></div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span>  <span class="keywordflow">if</span> (NRetTy-&gt;isVoidTy())</div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span>    RAttrs.remove(AttributeFuncs::typeIncompatible(NRetTy));</div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno">  842</span>  <span class="keywordflow">else</span></div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span>    <a class="code hl_function" href="DeadArgumentElimination_8cpp.html#aa5bfc84fa71b9e3477e24efecb60fae5">assert</a>(!RAttrs.overlaps(AttributeFuncs::typeIncompatible(NRetTy)) &amp;&amp;</div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span>           <span class="stringliteral">&quot;Return attributes no longer compatible?&quot;</span>);</div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno">  845</span> </div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span>  AttributeSet RetAttrs = AttributeSet::get(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getContext(), RAttrs);</div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno">  847</span> </div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span>  <span class="comment">// Strip allocsize attributes. They might refer to the deleted arguments.</span></div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span>  AttributeSet FnAttrs = PAL.getFnAttributes().removeAttribute(</div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span>      <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getContext(), Attribute::AllocSize);</div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno">  851</span> </div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span>  <span class="comment">// Reconstruct the AttributesList based on the vector we constructed.</span></div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno">  853</span>  <a class="code hl_function" href="DeadArgumentElimination_8cpp.html#aa5bfc84fa71b9e3477e24efecb60fae5">assert</a>(ArgAttrVec.size() == Params.size());</div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno">  854</span>  AttributeList NewPAL =</div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno">  855</span>      AttributeList::get(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getContext(), FnAttrs, RetAttrs, ArgAttrVec);</div>
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno">  856</span> </div>
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno">  857</span>  <span class="comment">// Create the new function type based on the recomputed parameters.</span></div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span>  FunctionType *NFTy = FunctionType::get(NRetTy, Params, FTy-&gt;isVarArg());</div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span> </div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span>  <span class="comment">// No change?</span></div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span>  <span class="keywordflow">if</span> (NFTy == FTy)</div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno">  863</span> </div>
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno">  864</span>  <span class="comment">// Create the new function body and insert it into the module...</span></div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span>  Function *NF = Function::Create(NFTy, <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getLinkage(), <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getAddressSpace());</div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span>  NF-&gt;copyAttributesFrom(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span>  NF-&gt;setComdat(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getComdat());</div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno">  868</span>  NF-&gt;setAttributes(NewPAL);</div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno">  869</span>  <span class="comment">// Insert the new function before the old function, so we won&#39;t be processing</span></div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno">  870</span>  <span class="comment">// it again.</span></div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno">  871</span>  <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getParent()-&gt;getFunctionList().insert(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getIterator(), NF);</div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span>  NF-&gt;takeName(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span> </div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span>  <span class="comment">// Loop over all of the callers of the function, transforming the call sites</span></div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span>  <span class="comment">// to pass in a smaller number of arguments into the new function.</span></div>
<div class="line"><a id="l00876" name="l00876"></a><span class="lineno">  876</span>  std::vector&lt;Value*&gt; Args;</div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span>  <span class="keywordflow">while</span> (!<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;use_empty()) {</div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span>    CallSite CS(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;user_back());</div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno">  879</span>    Instruction *Call = CS.getInstruction();</div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span> </div>
<div class="line"><a id="l00881" name="l00881"></a><span class="lineno">  881</span>    ArgAttrVec.clear();</div>
<div class="line"><a id="l00882" name="l00882"></a><span class="lineno">  882</span>    <span class="keyword">const</span> AttributeList &amp;CallPAL = CS.getAttributes();</div>
<div class="line"><a id="l00883" name="l00883"></a><span class="lineno">  883</span> </div>
<div class="line"><a id="l00884" name="l00884"></a><span class="lineno">  884</span>    <span class="comment">// Adjust the call return attributes in case the function was changed to</span></div>
<div class="line"><a id="l00885" name="l00885"></a><span class="lineno">  885</span>    <span class="comment">// return void.</span></div>
<div class="line"><a id="l00886" name="l00886"></a><span class="lineno">  886</span>    AttrBuilder RAttrs(CallPAL.getRetAttributes());</div>
<div class="line"><a id="l00887" name="l00887"></a><span class="lineno">  887</span>    RAttrs.remove(AttributeFuncs::typeIncompatible(NRetTy));</div>
<div class="line"><a id="l00888" name="l00888"></a><span class="lineno">  888</span>    AttributeSet RetAttrs = AttributeSet::get(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getContext(), RAttrs);</div>
<div class="line"><a id="l00889" name="l00889"></a><span class="lineno">  889</span> </div>
<div class="line"><a id="l00890" name="l00890"></a><span class="lineno">  890</span>    <span class="comment">// Declare these outside of the loops, so we can reuse them for the second</span></div>
<div class="line"><a id="l00891" name="l00891"></a><span class="lineno">  891</span>    <span class="comment">// loop, which loops the varargs.</span></div>
<div class="line"><a id="l00892" name="l00892"></a><span class="lineno">  892</span>    CallSite::arg_iterator <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = CS.arg_begin();</div>
<div class="line"><a id="l00893" name="l00893"></a><span class="lineno">  893</span>    <span class="keywordtype">unsigned</span> i = 0;</div>
<div class="line"><a id="l00894" name="l00894"></a><span class="lineno">  894</span>    <span class="comment">// Loop over those operands, corresponding to the normal arguments to the</span></div>
<div class="line"><a id="l00895" name="l00895"></a><span class="lineno">  895</span>    <span class="comment">// original function, and add those that are still alive.</span></div>
<div class="line"><a id="l00896" name="l00896"></a><span class="lineno">  896</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> e = FTy-&gt;getNumParams(); i != e; ++<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, ++i)</div>
<div class="line"><a id="l00897" name="l00897"></a><span class="lineno">  897</span>      <span class="keywordflow">if</span> (ArgAlive[i]) {</div>
<div class="line"><a id="l00898" name="l00898"></a><span class="lineno">  898</span>        Args.push_back(*<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a id="l00899" name="l00899"></a><span class="lineno">  899</span>        <span class="comment">// Get original parameter attributes, but skip return attributes.</span></div>
<div class="line"><a id="l00900" name="l00900"></a><span class="lineno">  900</span>        AttributeSet Attrs = CallPAL.getParamAttributes(i);</div>
<div class="line"><a id="l00901" name="l00901"></a><span class="lineno">  901</span>        <span class="keywordflow">if</span> (NRetTy != <a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#ae9e8b37f293199ceac2a52f811e26a3e">RetTy</a> &amp;&amp; Attrs.hasAttribute(Attribute::Returned)) {</div>
<div class="line"><a id="l00902" name="l00902"></a><span class="lineno">  902</span>          <span class="comment">// If the return type has changed, then get rid of &#39;returned&#39; on the</span></div>
<div class="line"><a id="l00903" name="l00903"></a><span class="lineno">  903</span>          <span class="comment">// call site. The alternative is to make all &#39;returned&#39; attributes on</span></div>
<div class="line"><a id="l00904" name="l00904"></a><span class="lineno">  904</span>          <span class="comment">// call sites keep the return value alive just like &#39;returned&#39;</span></div>
<div class="line"><a id="l00905" name="l00905"></a><span class="lineno">  905</span>          <span class="comment">// attributes on function declaration but it&#39;s less clearly a win and</span></div>
<div class="line"><a id="l00906" name="l00906"></a><span class="lineno">  906</span>          <span class="comment">// this is not an expected case anyway</span></div>
<div class="line"><a id="l00907" name="l00907"></a><span class="lineno">  907</span>          ArgAttrVec.push_back(AttributeSet::get(</div>
<div class="line"><a id="l00908" name="l00908"></a><span class="lineno">  908</span>              <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getContext(),</div>
<div class="line"><a id="l00909" name="l00909"></a><span class="lineno">  909</span>              AttrBuilder(Attrs).removeAttribute(Attribute::Returned)));</div>
<div class="line"><a id="l00910" name="l00910"></a><span class="lineno">  910</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00911" name="l00911"></a><span class="lineno">  911</span>          <span class="comment">// Otherwise, use the original attributes.</span></div>
<div class="line"><a id="l00912" name="l00912"></a><span class="lineno">  912</span>          ArgAttrVec.push_back(Attrs);</div>
<div class="line"><a id="l00913" name="l00913"></a><span class="lineno">  913</span>        }</div>
<div class="line"><a id="l00914" name="l00914"></a><span class="lineno">  914</span>      }</div>
<div class="line"><a id="l00915" name="l00915"></a><span class="lineno">  915</span> </div>
<div class="line"><a id="l00916" name="l00916"></a><span class="lineno">  916</span>    <span class="comment">// Push any varargs arguments on the list. Don&#39;t forget their attributes.</span></div>
<div class="line"><a id="l00917" name="l00917"></a><span class="lineno">  917</span>    <span class="keywordflow">for</span> (CallSite::arg_iterator E = CS.arg_end(); <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, ++i) {</div>
<div class="line"><a id="l00918" name="l00918"></a><span class="lineno">  918</span>      Args.push_back(*<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a id="l00919" name="l00919"></a><span class="lineno">  919</span>      ArgAttrVec.push_back(CallPAL.getParamAttributes(i));</div>
<div class="line"><a id="l00920" name="l00920"></a><span class="lineno">  920</span>    }</div>
<div class="line"><a id="l00921" name="l00921"></a><span class="lineno">  921</span> </div>
<div class="line"><a id="l00922" name="l00922"></a><span class="lineno">  922</span>    <span class="comment">// Reconstruct the AttributesList based on the vector we constructed.</span></div>
<div class="line"><a id="l00923" name="l00923"></a><span class="lineno">  923</span>    <a class="code hl_function" href="DeadArgumentElimination_8cpp.html#aa5bfc84fa71b9e3477e24efecb60fae5">assert</a>(ArgAttrVec.size() == Args.size());</div>
<div class="line"><a id="l00924" name="l00924"></a><span class="lineno">  924</span> </div>
<div class="line"><a id="l00925" name="l00925"></a><span class="lineno">  925</span>    <span class="comment">// Again, be sure to remove any allocsize attributes, since their indices</span></div>
<div class="line"><a id="l00926" name="l00926"></a><span class="lineno">  926</span>    <span class="comment">// may now be incorrect.</span></div>
<div class="line"><a id="l00927" name="l00927"></a><span class="lineno">  927</span>    AttributeSet FnAttrs = CallPAL.getFnAttributes().removeAttribute(</div>
<div class="line"><a id="l00928" name="l00928"></a><span class="lineno">  928</span>        <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getContext(), Attribute::AllocSize);</div>
<div class="line"><a id="l00929" name="l00929"></a><span class="lineno">  929</span> </div>
<div class="line"><a id="l00930" name="l00930"></a><span class="lineno">  930</span>    AttributeList NewCallPAL = AttributeList::get(</div>
<div class="line"><a id="l00931" name="l00931"></a><span class="lineno">  931</span>        <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getContext(), FnAttrs, RetAttrs, ArgAttrVec);</div>
<div class="line"><a id="l00932" name="l00932"></a><span class="lineno">  932</span> </div>
<div class="line"><a id="l00933" name="l00933"></a><span class="lineno">  933</span>    <a class="code hl_class" href="classSmallVector.html">SmallVector&lt;OperandBundleDef, 1&gt;</a> OpBundles;</div>
<div class="line"><a id="l00934" name="l00934"></a><span class="lineno">  934</span>    CS.getOperandBundlesAsDefs(OpBundles);</div>
<div class="line"><a id="l00935" name="l00935"></a><span class="lineno">  935</span> </div>
<div class="line"><a id="l00936" name="l00936"></a><span class="lineno">  936</span>    CallSite NewCS;</div>
<div class="line"><a id="l00937" name="l00937"></a><span class="lineno">  937</span>    <span class="keywordflow">if</span> (InvokeInst *II = dyn_cast&lt;InvokeInst&gt;(Call)) {</div>
<div class="line"><a id="l00938" name="l00938"></a><span class="lineno">  938</span>      NewCS = InvokeInst::Create(NF, II-&gt;getNormalDest(), II-&gt;getUnwindDest(),</div>
<div class="line"><a id="l00939" name="l00939"></a><span class="lineno">  939</span>                                 Args, OpBundles, <span class="stringliteral">&quot;&quot;</span>, Call-&gt;getParent());</div>
<div class="line"><a id="l00940" name="l00940"></a><span class="lineno">  940</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00941" name="l00941"></a><span class="lineno">  941</span>      NewCS = CallInst::Create(NFTy, NF, Args, OpBundles, <span class="stringliteral">&quot;&quot;</span>, Call);</div>
<div class="line"><a id="l00942" name="l00942"></a><span class="lineno">  942</span>      cast&lt;CallInst&gt;(NewCS.getInstruction())</div>
<div class="line"><a id="l00943" name="l00943"></a><span class="lineno">  943</span>          -&gt;setTailCallKind(cast&lt;CallInst&gt;(Call)-&gt;getTailCallKind());</div>
<div class="line"><a id="l00944" name="l00944"></a><span class="lineno">  944</span>    }</div>
<div class="line"><a id="l00945" name="l00945"></a><span class="lineno">  945</span>    NewCS.setCallingConv(CS.getCallingConv());</div>
<div class="line"><a id="l00946" name="l00946"></a><span class="lineno">  946</span>    NewCS.setAttributes(NewCallPAL);</div>
<div class="line"><a id="l00947" name="l00947"></a><span class="lineno">  947</span>    NewCS-&gt;setDebugLoc(Call-&gt;getDebugLoc());</div>
<div class="line"><a id="l00948" name="l00948"></a><span class="lineno">  948</span>    uint64_t W;</div>
<div class="line"><a id="l00949" name="l00949"></a><span class="lineno">  949</span>    <span class="keywordflow">if</span> (Call-&gt;extractProfTotalWeight(W))</div>
<div class="line"><a id="l00950" name="l00950"></a><span class="lineno">  950</span>      NewCS-&gt;setProfWeight(W);</div>
<div class="line"><a id="l00951" name="l00951"></a><span class="lineno">  951</span>    Args.clear();</div>
<div class="line"><a id="l00952" name="l00952"></a><span class="lineno">  952</span>    ArgAttrVec.clear();</div>
<div class="line"><a id="l00953" name="l00953"></a><span class="lineno">  953</span> </div>
<div class="line"><a id="l00954" name="l00954"></a><span class="lineno">  954</span>    Instruction *New = NewCS.getInstruction();</div>
<div class="line"><a id="l00955" name="l00955"></a><span class="lineno">  955</span>    <span class="keywordflow">if</span> (!Call-&gt;use_empty() || Call-&gt;isUsedByMetadata()) {</div>
<div class="line"><a id="l00956" name="l00956"></a><span class="lineno">  956</span>      <span class="keywordflow">if</span> (New-&gt;getType() == Call-&gt;getType()) {</div>
<div class="line"><a id="l00957" name="l00957"></a><span class="lineno">  957</span>        <span class="comment">// Return type not changed? Just replace users then.</span></div>
<div class="line"><a id="l00958" name="l00958"></a><span class="lineno">  958</span>        Call-&gt;replaceAllUsesWith(New);</div>
<div class="line"><a id="l00959" name="l00959"></a><span class="lineno">  959</span>        New-&gt;takeName(Call);</div>
<div class="line"><a id="l00960" name="l00960"></a><span class="lineno">  960</span>      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (New-&gt;getType()-&gt;isVoidTy()) {</div>
<div class="line"><a id="l00961" name="l00961"></a><span class="lineno">  961</span>        <span class="comment">// If the return value is dead, replace any uses of it with undef</span></div>
<div class="line"><a id="l00962" name="l00962"></a><span class="lineno">  962</span>        <span class="comment">// (any non-debug value uses will get removed later on).</span></div>
<div class="line"><a id="l00963" name="l00963"></a><span class="lineno">  963</span>        <span class="keywordflow">if</span> (!Call-&gt;getType()-&gt;isX86_MMXTy())</div>
<div class="line"><a id="l00964" name="l00964"></a><span class="lineno">  964</span>          Call-&gt;replaceAllUsesWith(UndefValue::get(Call-&gt;getType()));</div>
<div class="line"><a id="l00965" name="l00965"></a><span class="lineno">  965</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00966" name="l00966"></a><span class="lineno">  966</span>        <a class="code hl_function" href="DeadArgumentElimination_8cpp.html#aa5bfc84fa71b9e3477e24efecb60fae5">assert</a>((<a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#ae9e8b37f293199ceac2a52f811e26a3e">RetTy</a>-&gt;isStructTy() || <a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#ae9e8b37f293199ceac2a52f811e26a3e">RetTy</a>-&gt;isArrayTy()) &amp;&amp;</div>
<div class="line"><a id="l00967" name="l00967"></a><span class="lineno">  967</span>               <span class="stringliteral">&quot;Return type changed, but not into a void. The old return type&quot;</span></div>
<div class="line"><a id="l00968" name="l00968"></a><span class="lineno">  968</span>               <span class="stringliteral">&quot; must have been a struct or an array!&quot;</span>);</div>
<div class="line"><a id="l00969" name="l00969"></a><span class="lineno">  969</span>        Instruction *InsertPt = Call;</div>
<div class="line"><a id="l00970" name="l00970"></a><span class="lineno">  970</span>        <span class="keywordflow">if</span> (InvokeInst *II = dyn_cast&lt;InvokeInst&gt;(Call)) {</div>
<div class="line"><a id="l00971" name="l00971"></a><span class="lineno">  971</span>          BasicBlock *NewEdge = SplitEdge(New-&gt;getParent(), II-&gt;getNormalDest());</div>
<div class="line"><a id="l00972" name="l00972"></a><span class="lineno">  972</span>          InsertPt = &amp;*NewEdge-&gt;getFirstInsertionPt();</div>
<div class="line"><a id="l00973" name="l00973"></a><span class="lineno">  973</span>        }</div>
<div class="line"><a id="l00974" name="l00974"></a><span class="lineno">  974</span> </div>
<div class="line"><a id="l00975" name="l00975"></a><span class="lineno">  975</span>        <span class="comment">// We used to return a struct or array. Instead of doing smart stuff</span></div>
<div class="line"><a id="l00976" name="l00976"></a><span class="lineno">  976</span>        <span class="comment">// with all the uses, we will just rebuild it using extract/insertvalue</span></div>
<div class="line"><a id="l00977" name="l00977"></a><span class="lineno">  977</span>        <span class="comment">// chaining and let instcombine clean that up.</span></div>
<div class="line"><a id="l00978" name="l00978"></a><span class="lineno">  978</span>        <span class="comment">//</span></div>
<div class="line"><a id="l00979" name="l00979"></a><span class="lineno">  979</span>        <span class="comment">// Start out building up our return value from undef</span></div>
<div class="line"><a id="l00980" name="l00980"></a><span class="lineno">  980</span>        Value *RetVal = UndefValue::get(<a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#ae9e8b37f293199ceac2a52f811e26a3e">RetTy</a>);</div>
<div class="line"><a id="l00981" name="l00981"></a><span class="lineno">  981</span>        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i != RetCount; ++i)</div>
<div class="line"><a id="l00982" name="l00982"></a><span class="lineno">  982</span>          <span class="keywordflow">if</span> (NewRetIdxs[i] != -1) {</div>
<div class="line"><a id="l00983" name="l00983"></a><span class="lineno">  983</span>            Value *V;</div>
<div class="line"><a id="l00984" name="l00984"></a><span class="lineno">  984</span>            <span class="keywordflow">if</span> (RetTypes.size() &gt; 1)</div>
<div class="line"><a id="l00985" name="l00985"></a><span class="lineno">  985</span>              <span class="comment">// We are still returning a struct, so extract the value from our</span></div>
<div class="line"><a id="l00986" name="l00986"></a><span class="lineno">  986</span>              <span class="comment">// return value</span></div>
<div class="line"><a id="l00987" name="l00987"></a><span class="lineno">  987</span>              V = ExtractValueInst::Create(New, NewRetIdxs[i], <span class="stringliteral">&quot;newret&quot;</span>,</div>
<div class="line"><a id="l00988" name="l00988"></a><span class="lineno">  988</span>                                           InsertPt);</div>
<div class="line"><a id="l00989" name="l00989"></a><span class="lineno">  989</span>            <span class="keywordflow">else</span></div>
<div class="line"><a id="l00990" name="l00990"></a><span class="lineno">  990</span>              <span class="comment">// We are now returning a single element, so just insert that</span></div>
<div class="line"><a id="l00991" name="l00991"></a><span class="lineno">  991</span>              V = New;</div>
<div class="line"><a id="l00992" name="l00992"></a><span class="lineno">  992</span>            <span class="comment">// Insert the value at the old position</span></div>
<div class="line"><a id="l00993" name="l00993"></a><span class="lineno">  993</span>            RetVal = InsertValueInst::Create(RetVal, V, i, <span class="stringliteral">&quot;oldret&quot;</span>, InsertPt);</div>
<div class="line"><a id="l00994" name="l00994"></a><span class="lineno">  994</span>          }</div>
<div class="line"><a id="l00995" name="l00995"></a><span class="lineno">  995</span>        <span class="comment">// Now, replace all uses of the old call instruction with the return</span></div>
<div class="line"><a id="l00996" name="l00996"></a><span class="lineno">  996</span>        <span class="comment">// struct we built</span></div>
<div class="line"><a id="l00997" name="l00997"></a><span class="lineno">  997</span>        Call-&gt;replaceAllUsesWith(RetVal);</div>
<div class="line"><a id="l00998" name="l00998"></a><span class="lineno">  998</span>        New-&gt;takeName(Call);</div>
<div class="line"><a id="l00999" name="l00999"></a><span class="lineno">  999</span>      }</div>
<div class="line"><a id="l01000" name="l01000"></a><span class="lineno"> 1000</span>    }</div>
<div class="line"><a id="l01001" name="l01001"></a><span class="lineno"> 1001</span> </div>
<div class="line"><a id="l01002" name="l01002"></a><span class="lineno"> 1002</span>    <span class="comment">// Finally, remove the old call from the program, reducing the use-count of</span></div>
<div class="line"><a id="l01003" name="l01003"></a><span class="lineno"> 1003</span>    <span class="comment">// F.</span></div>
<div class="line"><a id="l01004" name="l01004"></a><span class="lineno"> 1004</span>    Call-&gt;eraseFromParent();</div>
<div class="line"><a id="l01005" name="l01005"></a><span class="lineno"> 1005</span>  }</div>
<div class="line"><a id="l01006" name="l01006"></a><span class="lineno"> 1006</span> </div>
<div class="line"><a id="l01007" name="l01007"></a><span class="lineno"> 1007</span>  <span class="comment">// Since we have now created the new function, splice the body of the old</span></div>
<div class="line"><a id="l01008" name="l01008"></a><span class="lineno"> 1008</span>  <span class="comment">// function right into the new function, leaving the old rotting hulk of the</span></div>
<div class="line"><a id="l01009" name="l01009"></a><span class="lineno"> 1009</span>  <span class="comment">// function empty.</span></div>
<div class="line"><a id="l01010" name="l01010"></a><span class="lineno"> 1010</span>  NF-&gt;getBasicBlockList().splice(NF-&gt;begin(), <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getBasicBlockList());</div>
<div class="line"><a id="l01011" name="l01011"></a><span class="lineno"> 1011</span> </div>
<div class="line"><a id="l01012" name="l01012"></a><span class="lineno"> 1012</span>  <span class="comment">// Loop over the argument list, transferring uses of the old arguments over to</span></div>
<div class="line"><a id="l01013" name="l01013"></a><span class="lineno"> 1013</span>  <span class="comment">// the new arguments, also transferring over the names as well.</span></div>
<div class="line"><a id="l01014" name="l01014"></a><span class="lineno"> 1014</span>  i = 0;</div>
<div class="line"><a id="l01015" name="l01015"></a><span class="lineno"> 1015</span>  <span class="keywordflow">for</span> (Function::arg_iterator <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;arg_begin(), E = <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;arg_end(),</div>
<div class="line"><a id="l01016" name="l01016"></a><span class="lineno"> 1016</span>       I2 = NF-&gt;arg_begin(); <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, ++i)</div>
<div class="line"><a id="l01017" name="l01017"></a><span class="lineno"> 1017</span>    <span class="keywordflow">if</span> (ArgAlive[i]) {</div>
<div class="line"><a id="l01018" name="l01018"></a><span class="lineno"> 1018</span>      <span class="comment">// If this is a live argument, move the name and users over to the new</span></div>
<div class="line"><a id="l01019" name="l01019"></a><span class="lineno"> 1019</span>      <span class="comment">// version.</span></div>
<div class="line"><a id="l01020" name="l01020"></a><span class="lineno"> 1020</span>      <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;replaceAllUsesWith(&amp;*I2);</div>
<div class="line"><a id="l01021" name="l01021"></a><span class="lineno"> 1021</span>      I2-&gt;takeName(&amp;*<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a id="l01022" name="l01022"></a><span class="lineno"> 1022</span>      ++I2;</div>
<div class="line"><a id="l01023" name="l01023"></a><span class="lineno"> 1023</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01024" name="l01024"></a><span class="lineno"> 1024</span>      <span class="comment">// If this argument is dead, replace any uses of it with undef</span></div>
<div class="line"><a id="l01025" name="l01025"></a><span class="lineno"> 1025</span>      <span class="comment">// (any non-debug value uses will get removed later on).</span></div>
<div class="line"><a id="l01026" name="l01026"></a><span class="lineno"> 1026</span>      <span class="keywordflow">if</span> (!<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType()-&gt;isX86_MMXTy())</div>
<div class="line"><a id="l01027" name="l01027"></a><span class="lineno"> 1027</span>        <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;replaceAllUsesWith(UndefValue::get(<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType()));</div>
<div class="line"><a id="l01028" name="l01028"></a><span class="lineno"> 1028</span>    }</div>
<div class="line"><a id="l01029" name="l01029"></a><span class="lineno"> 1029</span> </div>
<div class="line"><a id="l01030" name="l01030"></a><span class="lineno"> 1030</span>  <span class="comment">// If we change the return value of the function we must rewrite any return</span></div>
<div class="line"><a id="l01031" name="l01031"></a><span class="lineno"> 1031</span>  <span class="comment">// instructions.  Check this now.</span></div>
<div class="line"><a id="l01032" name="l01032"></a><span class="lineno"> 1032</span>  <span class="keywordflow">if</span> (<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getReturnType() != NF-&gt;getReturnType())</div>
<div class="line"><a id="l01033" name="l01033"></a><span class="lineno"> 1033</span>    <span class="keywordflow">for</span> (BasicBlock &amp;BB : *NF)</div>
<div class="line"><a id="l01034" name="l01034"></a><span class="lineno"> 1034</span>      <span class="keywordflow">if</span> (ReturnInst *RI = dyn_cast&lt;ReturnInst&gt;(BB.getTerminator())) {</div>
<div class="line"><a id="l01035" name="l01035"></a><span class="lineno"> 1035</span>        Value *RetVal;</div>
<div class="line"><a id="l01036" name="l01036"></a><span class="lineno"> 1036</span> </div>
<div class="line"><a id="l01037" name="l01037"></a><span class="lineno"> 1037</span>        <span class="keywordflow">if</span> (NFTy-&gt;getReturnType()-&gt;isVoidTy()) {</div>
<div class="line"><a id="l01038" name="l01038"></a><span class="lineno"> 1038</span>          RetVal = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l01039" name="l01039"></a><span class="lineno"> 1039</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01040" name="l01040"></a><span class="lineno"> 1040</span>          <a class="code hl_function" href="DeadArgumentElimination_8cpp.html#aa5bfc84fa71b9e3477e24efecb60fae5">assert</a>(<a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#ae9e8b37f293199ceac2a52f811e26a3e">RetTy</a>-&gt;isStructTy() || <a class="code hl_variable" href="DeadArgumentElimination_8cpp.html#ae9e8b37f293199ceac2a52f811e26a3e">RetTy</a>-&gt;isArrayTy());</div>
<div class="line"><a id="l01041" name="l01041"></a><span class="lineno"> 1041</span>          <span class="comment">// The original return value was a struct or array, insert</span></div>
<div class="line"><a id="l01042" name="l01042"></a><span class="lineno"> 1042</span>          <span class="comment">// extractvalue/insertvalue chains to extract only the values we need</span></div>
<div class="line"><a id="l01043" name="l01043"></a><span class="lineno"> 1043</span>          <span class="comment">// to return and insert them into our new result.</span></div>
<div class="line"><a id="l01044" name="l01044"></a><span class="lineno"> 1044</span>          <span class="comment">// This does generate messy code, but we&#39;ll let it to instcombine to</span></div>
<div class="line"><a id="l01045" name="l01045"></a><span class="lineno"> 1045</span>          <span class="comment">// clean that up.</span></div>
<div class="line"><a id="l01046" name="l01046"></a><span class="lineno"> 1046</span>          Value *OldRet = RI-&gt;getOperand(0);</div>
<div class="line"><a id="l01047" name="l01047"></a><span class="lineno"> 1047</span>          <span class="comment">// Start out building up our return value from undef</span></div>
<div class="line"><a id="l01048" name="l01048"></a><span class="lineno"> 1048</span>          RetVal = UndefValue::get(NRetTy);</div>
<div class="line"><a id="l01049" name="l01049"></a><span class="lineno"> 1049</span>          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i != RetCount; ++i)</div>
<div class="line"><a id="l01050" name="l01050"></a><span class="lineno"> 1050</span>            <span class="keywordflow">if</span> (NewRetIdxs[i] != -1) {</div>
<div class="line"><a id="l01051" name="l01051"></a><span class="lineno"> 1051</span>              ExtractValueInst *EV = ExtractValueInst::Create(OldRet, i,</div>
<div class="line"><a id="l01052" name="l01052"></a><span class="lineno"> 1052</span>                                                              <span class="stringliteral">&quot;oldret&quot;</span>, RI);</div>
<div class="line"><a id="l01053" name="l01053"></a><span class="lineno"> 1053</span>              <span class="keywordflow">if</span> (RetTypes.size() &gt; 1) {</div>
<div class="line"><a id="l01054" name="l01054"></a><span class="lineno"> 1054</span>                <span class="comment">// We&#39;re still returning a struct, so reinsert the value into</span></div>
<div class="line"><a id="l01055" name="l01055"></a><span class="lineno"> 1055</span>                <span class="comment">// our new return value at the new index</span></div>
<div class="line"><a id="l01056" name="l01056"></a><span class="lineno"> 1056</span> </div>
<div class="line"><a id="l01057" name="l01057"></a><span class="lineno"> 1057</span>                RetVal = InsertValueInst::Create(RetVal, EV, NewRetIdxs[i],</div>
<div class="line"><a id="l01058" name="l01058"></a><span class="lineno"> 1058</span>                                                 <span class="stringliteral">&quot;newret&quot;</span>, RI);</div>
<div class="line"><a id="l01059" name="l01059"></a><span class="lineno"> 1059</span>              } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01060" name="l01060"></a><span class="lineno"> 1060</span>                <span class="comment">// We are now only returning a simple value, so just return the</span></div>
<div class="line"><a id="l01061" name="l01061"></a><span class="lineno"> 1061</span>                <span class="comment">// extracted value.</span></div>
<div class="line"><a id="l01062" name="l01062"></a><span class="lineno"> 1062</span>                RetVal = EV;</div>
<div class="line"><a id="l01063" name="l01063"></a><span class="lineno"> 1063</span>              }</div>
<div class="line"><a id="l01064" name="l01064"></a><span class="lineno"> 1064</span>            }</div>
<div class="line"><a id="l01065" name="l01065"></a><span class="lineno"> 1065</span>        }</div>
<div class="line"><a id="l01066" name="l01066"></a><span class="lineno"> 1066</span>        <span class="comment">// Replace the return instruction with one returning the new return</span></div>
<div class="line"><a id="l01067" name="l01067"></a><span class="lineno"> 1067</span>        <span class="comment">// value (possibly 0 if we became void).</span></div>
<div class="line"><a id="l01068" name="l01068"></a><span class="lineno"> 1068</span>        ReturnInst::Create(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getContext(), RetVal, RI);</div>
<div class="line"><a id="l01069" name="l01069"></a><span class="lineno"> 1069</span>        BB.getInstList().erase(RI);</div>
<div class="line"><a id="l01070" name="l01070"></a><span class="lineno"> 1070</span>      }</div>
<div class="line"><a id="l01071" name="l01071"></a><span class="lineno"> 1071</span> </div>
<div class="line"><a id="l01072" name="l01072"></a><span class="lineno"> 1072</span>  <span class="comment">// Clone metadatas from the old function, including debug info descriptor.</span></div>
<div class="line"><a id="l01073" name="l01073"></a><span class="lineno"> 1073</span>  <a class="code hl_class" href="classSmallVector.html">SmallVector&lt;std::pair&lt;unsigned, MDNode *&gt;</a>, 1&gt; MDs;</div>
<div class="line"><a id="l01074" name="l01074"></a><span class="lineno"> 1074</span>  <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getAllMetadata(MDs);</div>
<div class="line"><a id="l01075" name="l01075"></a><span class="lineno"> 1075</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> MD : MDs)</div>
<div class="line"><a id="l01076" name="l01076"></a><span class="lineno"> 1076</span>    NF-&gt;addMetadata(MD.first, *MD.second);</div>
<div class="line"><a id="l01077" name="l01077"></a><span class="lineno"> 1077</span> </div>
<div class="line"><a id="l01078" name="l01078"></a><span class="lineno"> 1078</span>  <span class="comment">// Now that the old function is dead, delete it.</span></div>
<div class="line"><a id="l01079" name="l01079"></a><span class="lineno"> 1079</span>  <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;eraseFromParent();</div>
<div class="line"><a id="l01080" name="l01080"></a><span class="lineno"> 1080</span> </div>
<div class="line"><a id="l01081" name="l01081"></a><span class="lineno"> 1081</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01082" name="l01082"></a><span class="lineno"> 1082</span>}</div>
<div class="line"><a id="l01083" name="l01083"></a><span class="lineno"> 1083</span> </div>
<div class="line"><a id="l01084" name="l01084"></a><span class="lineno"> 1084</span>PreservedAnalyses DeadArgumentEliminationPass::run(Module &amp;M,</div>
<div class="line"><a id="l01085" name="l01085"></a><span class="lineno"> 1085</span>                                                   ModuleAnalysisManager &amp;) {</div>
<div class="line"><a id="l01086" name="l01086"></a><span class="lineno"> 1086</span>  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01087" name="l01087"></a><span class="lineno"> 1087</span> </div>
<div class="line"><a id="l01088" name="l01088"></a><span class="lineno"> 1088</span>  <span class="comment">// First pass: Do a simple check to see if any functions can have their &quot;...&quot;</span></div>
<div class="line"><a id="l01089" name="l01089"></a><span class="lineno"> 1089</span>  <span class="comment">// removed.  We can do this if they never call va_start.  This loop cannot be</span></div>
<div class="line"><a id="l01090" name="l01090"></a><span class="lineno"> 1090</span>  <span class="comment">// fused with the next loop, because deleting a function invalidates</span></div>
<div class="line"><a id="l01091" name="l01091"></a><span class="lineno"> 1091</span>  <span class="comment">// information computed while surveying other functions.</span></div>
<div class="line"><a id="l01092" name="l01092"></a><span class="lineno"> 1092</span>  LLVM_DEBUG(dbgs() &lt;&lt; <span class="stringliteral">&quot;DeadArgumentEliminationPass - Deleting dead varargs\n&quot;</span>);</div>
<div class="line"><a id="l01093" name="l01093"></a><span class="lineno"> 1093</span>  <span class="keywordflow">for</span> (Module::iterator <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = M.begin(), E = M.end(); <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ) {</div>
<div class="line"><a id="l01094" name="l01094"></a><span class="lineno"> 1094</span>    Function &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = *<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>++;</div>
<div class="line"><a id="l01095" name="l01095"></a><span class="lineno"> 1095</span>    <span class="keywordflow">if</span> (<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getFunctionType()-&gt;isVarArg())</div>
<div class="line"><a id="l01096" name="l01096"></a><span class="lineno"> 1096</span>      Changed |= DeleteDeadVarargs(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l01097" name="l01097"></a><span class="lineno"> 1097</span>  }</div>
<div class="line"><a id="l01098" name="l01098"></a><span class="lineno"> 1098</span> </div>
<div class="line"><a id="l01099" name="l01099"></a><span class="lineno"> 1099</span>  <span class="comment">// Second phase:loop through the module, determining which arguments are live.</span></div>
<div class="line"><a id="l01100" name="l01100"></a><span class="lineno"> 1100</span>  <span class="comment">// We assume all arguments are dead unless proven otherwise (allowing us to</span></div>
<div class="line"><a id="l01101" name="l01101"></a><span class="lineno"> 1101</span>  <span class="comment">// determine that dead arguments passed into recursive functions are dead).</span></div>
<div class="line"><a id="l01102" name="l01102"></a><span class="lineno"> 1102</span>  <span class="comment">//</span></div>
<div class="line"><a id="l01103" name="l01103"></a><span class="lineno"> 1103</span>  LLVM_DEBUG(dbgs() &lt;&lt; <span class="stringliteral">&quot;DeadArgumentEliminationPass - Determining liveness\n&quot;</span>);</div>
<div class="line"><a id="l01104" name="l01104"></a><span class="lineno"> 1104</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> : M)</div>
<div class="line"><a id="l01105" name="l01105"></a><span class="lineno"> 1105</span>    SurveyFunction(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l01106" name="l01106"></a><span class="lineno"> 1106</span> </div>
<div class="line"><a id="l01107" name="l01107"></a><span class="lineno"> 1107</span>  <span class="comment">// Now, remove all dead arguments and return values from each function in</span></div>
<div class="line"><a id="l01108" name="l01108"></a><span class="lineno"> 1108</span>  <span class="comment">// turn.</span></div>
<div class="line"><a id="l01109" name="l01109"></a><span class="lineno"> 1109</span>  <span class="keywordflow">for</span> (Module::iterator <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = M.begin(), E = M.end(); <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ) {</div>
<div class="line"><a id="l01110" name="l01110"></a><span class="lineno"> 1110</span>    <span class="comment">// Increment now, because the function will probably get removed (ie.</span></div>
<div class="line"><a id="l01111" name="l01111"></a><span class="lineno"> 1111</span>    <span class="comment">// replaced by a new one).</span></div>
<div class="line"><a id="l01112" name="l01112"></a><span class="lineno"> 1112</span>    Function *<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = &amp;*<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>++;</div>
<div class="line"><a id="l01113" name="l01113"></a><span class="lineno"> 1113</span>    Changed |= RemoveDeadStuffFromFunction(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l01114" name="l01114"></a><span class="lineno"> 1114</span>  }</div>
<div class="line"><a id="l01115" name="l01115"></a><span class="lineno"> 1115</span> </div>
<div class="line"><a id="l01116" name="l01116"></a><span class="lineno"> 1116</span>  <span class="comment">// Finally, look for any unused parameters in functions with non-local</span></div>
<div class="line"><a id="l01117" name="l01117"></a><span class="lineno"> 1117</span>  <span class="comment">// linkage and replace the passed in parameters with undef.</span></div>
<div class="line"><a id="l01118" name="l01118"></a><span class="lineno"> 1118</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> : M)</div>
<div class="line"><a id="l01119" name="l01119"></a><span class="lineno"> 1119</span>    Changed |= RemoveDeadArgumentsFromCallers(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l01120" name="l01120"></a><span class="lineno"> 1120</span> </div>
<div class="line"><a id="l01121" name="l01121"></a><span class="lineno"> 1121</span>  <span class="keywordflow">if</span> (!Changed)</div>
<div class="line"><a id="l01122" name="l01122"></a><span class="lineno"> 1122</span>    <span class="keywordflow">return</span> PreservedAnalyses::all();</div>
<div class="line"><a id="l01123" name="l01123"></a><span class="lineno"> 1123</span>  <span class="keywordflow">return</span> PreservedAnalyses::none();</div>
<div class="line"><a id="l01124" name="l01124"></a><span class="lineno"> 1124</span>}</div>
<div class="ttc" id="aDeadArgumentElimination_8cpp_html_a1900bcaf9d2e4c769d421f858c7af5b0"><div class="ttname"><a href="DeadArgumentElimination_8cpp.html#a1900bcaf9d2e4c769d421f858c7af5b0">STATISTIC</a></div><div class="ttdeci">STATISTIC(NumArgumentsEliminated, &quot;Number of unread args removed&quot;)</div></div>
<div class="ttc" id="aDeadArgumentElimination_8cpp_html_a29f209bebc41a635b32c07fbcba0e34f"><div class="ttname"><a href="DeadArgumentElimination_8cpp.html#a29f209bebc41a635b32c07fbcba0e34f">INITIALIZE_PASS</a></div><div class="ttdeci">INITIALIZE_PASS(DAH, &quot;deadarghaX0r&quot;, &quot;Dead Argument Hacking (BUGPOINT USE ONLY; DO NOT USE)&quot;, false, false) ModulePass *llvm</div><div class="ttdoc">createDeadArgEliminationPass - This pass removes arguments from functions which are not used by the b...</div><div class="ttdef"><b>Definition:</b> <a href="DeadArgumentElimination_8cpp_source.html#l00110">DeadArgumentElimination.cpp:110</a></div></div>
<div class="ttc" id="aDeadArgumentElimination_8cpp_html_a39a491a969849f634027f20be70a5c57"><div class="ttname"><a href="DeadArgumentElimination_8cpp.html#a39a491a969849f634027f20be70a5c57">Idx</a></div><div class="ttdeci">Returns the sub type a function will return at a given Idx Should correspond to the result type of an ExtractValue instruction executed with just that one unsigned Idx</div><div class="ttdef"><b>Definition:</b> <a href="DeadArgumentElimination_8cpp_source.html#l00342">DeadArgumentElimination.cpp:342</a></div></div>
<div class="ttc" id="aDeadArgumentElimination_8cpp_html_a4cf8dce0e06abc322a465d6a2b779008"><div class="ttname"><a href="DeadArgumentElimination_8cpp.html#a4cf8dce0e06abc322a465d6a2b779008">NumRetVals</a></div><div class="ttdeci">Convenience function that returns the number of return values It returns for void functions and for functions not returning a struct It returns the number of struct elements for functions returning a struct static unsigned NumRetVals(const Function *F)</div><div class="ttdef"><b>Definition:</b> <a href="DeadArgumentElimination_8cpp_source.html#l00327">DeadArgumentElimination.cpp:327</a></div></div>
<div class="ttc" id="aDeadArgumentElimination_8cpp_html_a4e86f60fbe61a3e52ab0ba9183cc3fe5"><div class="ttname"><a href="DeadArgumentElimination_8cpp.html#a4e86f60fbe61a3e52ab0ba9183cc3fe5">Live</a></div><div class="ttdeci">SurveyUses This looks at all the uses of the given value Returns the Liveness deduced from the uses of this value Adds all uses that cause the result to be MaybeLive to MaybeLiveRetUses If the result is Live</div><div class="ttdef"><b>Definition:</b> <a href="DeadArgumentElimination_8cpp_source.html#l00463">DeadArgumentElimination.cpp:463</a></div></div>
<div class="ttc" id="aDeadArgumentElimination_8cpp_html_a51708575b9cff0a8b80837dac8427c4d"><div class="ttname"><a href="DeadArgumentElimination_8cpp.html#a51708575b9cff0a8b80837dac8427c4d">MaybeLive</a></div><div class="ttdeci">MarkValue This function marks the liveness of RA depending on L If L is MaybeLive</div><div class="ttdef"><b>Definition:</b> <a href="DeadArgumentElimination_8cpp_source.html#l00658">DeadArgumentElimination.cpp:658</a></div></div>
<div class="ttc" id="aDeadArgumentElimination_8cpp_html_aa5bfc84fa71b9e3477e24efecb60fae5"><div class="ttname"><a href="DeadArgumentElimination_8cpp.html#aa5bfc84fa71b9e3477e24efecb60fae5">assert</a></div><div class="ttdeci">assert(!RetTy-&gt;isVoidTy() &amp;&amp;&quot;void type has no subtype&quot;)</div></div>
<div class="ttc" id="aDeadArgumentElimination_8cpp_html_ad803921fc069868f5e116af2e3d4c819"><div class="ttname"><a href="DeadArgumentElimination_8cpp.html#ad803921fc069868f5e116af2e3d4c819">Uses</a></div><div class="ttdeci">MarkValue This function marks the liveness of RA depending on L If L is it also takes all uses in MaybeLiveUses and records them in Uses</div><div class="ttdef"><b>Definition:</b> <a href="DeadArgumentElimination_8cpp_source.html#l00658">DeadArgumentElimination.cpp:658</a></div></div>
<div class="ttc" id="aDeadArgumentElimination_8cpp_html_ae9e8b37f293199ceac2a52f811e26a3e"><div class="ttname"><a href="DeadArgumentElimination_8cpp.html#ae9e8b37f293199ceac2a52f811e26a3e">RetTy</a></div><div class="ttdeci">else return RetTy</div><div class="ttdef"><b>Definition:</b> <a href="DeadArgumentElimination_8cpp_source.html#l00351">DeadArgumentElimination.cpp:351</a></div></div>
<div class="ttc" id="aMD5_8cpp_html_a96d73bbd7af15cb1fc38c3f4a3bd82e9"><div class="ttname"><a href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a></div><div class="ttdeci">#define F(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00055">MD5.cpp:55</a></div></div>
<div class="ttc" id="aMD5_8cpp_html_ac0eafdc9ee161b71e7af98af736952fd"><div class="ttname"><a href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a></div><div class="ttdeci">#define I(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00058">MD5.cpp:58</a></div></div>
<div class="ttc" id="aclassIntrinsicInst_html"><div class="ttname"><a href="classIntrinsicInst.html">IntrinsicInst</a></div></div>
<div class="ttc" id="aclassSmallVector_html"><div class="ttname"><a href="classSmallVector.html">SmallVector</a></div></div>
<div class="ttc" id="anamespacellvm_1_1lltok_html_af353621f14cb4b4b3af5ffaff84076b1a62040556dca332b530d931cfc532410f"><div class="ttname"><a href="namespacellvm_1_1lltok.html#af353621f14cb4b4b3af5ffaff84076b1a62040556dca332b530d931cfc532410f">llvm::lltok::Type</a></div><div class="ttdeci">@ Type</div><div class="ttdef"><b>Definition:</b> <a href="LLToken_8h_source.html#l00462">LLToken.h:462</a></div></div>
<div class="ttc" id="anamespacellvm_html"><div class="ttname"><a href="namespacellvm.html">llvm</a></div><div class="ttdef"><b>Definition:</b> <a href="AliasAnalysisEvaluator_8cpp_source.html#l00394">AliasAnalysisEvaluator.cpp:394</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Jul 13 2022 12:44:40 for LLVM by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>
